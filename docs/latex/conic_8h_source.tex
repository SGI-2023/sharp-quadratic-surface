\doxysection{conic.\+h}
\hypertarget{conic_8h_source}{}\label{conic_8h_source}\index{src/core/conic.h@{src/core/conic.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ 2023\ Adobe\ Research.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ To\ view\ a\ copy\ of\ the\ license,\ visit\ LICENSE.md.}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <Eigen/Core>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}bivariate\_quadratic\_function.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}common.h"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{polynomial__function_8h}{polynomial\_function.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}rational\_function.h"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{enum\ class}\ ConicType}
\DoxyCodeLine{00015\ \{}
\DoxyCodeLine{00016\ \ \ ellipse,}
\DoxyCodeLine{00017\ \ \ hyperbola,}
\DoxyCodeLine{00018\ \ \ parabola,}
\DoxyCodeLine{00019\ \ \ parallel\_lines,}
\DoxyCodeLine{00020\ \ \ intersecting\_lines,}
\DoxyCodeLine{00021\ \ \ line,}
\DoxyCodeLine{00022\ \ \ point,}
\DoxyCodeLine{00023\ \ \ empty,}
\DoxyCodeLine{00024\ \ \ plane,}
\DoxyCodeLine{00025\ \ \ error,}
\DoxyCodeLine{00026\ \ \ unknown}
\DoxyCodeLine{00027\ \};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00030\ \textcolor{comment}{//\ class\ Conic\ :\ private\ RationalFunction\ \{}}
\DoxyCodeLine{00031\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_conic}{Conic}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_rational_function}{RationalFunction}}<2,\ 2>}
\DoxyCodeLine{00032\ \{}
\DoxyCodeLine{00033\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00035\ \ \ \mbox{\hyperlink{class_conic_a4748d289c87826dae9a38694f3f9fd0d}{Conic}}()\ \{\ m\_type\ =\ ConicType::unknown;\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \mbox{\hyperlink{class_conic_a4748d289c87826dae9a38694f3f9fd0d}{Conic}}(\textcolor{keyword}{const}\ Matrix3x2r\&\ numerator\_coeffs,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3x2}}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Eigen::Matrix<double,\ 3,\ 1>\&\ denominator\_coeffs\ \textcolor{comment}{//\ 3}}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00040\ \ \ \ \ :\ \mbox{\hyperlink{class_rational_function}{RationalFunction}}<2,\ 2>(numerator\_coeffs,\ denominator\_coeffs)}
\DoxyCodeLine{00041\ \ \ \{}
\DoxyCodeLine{00042\ \ \ \ \ m\_type\ =\ ConicType::unknown;}
\DoxyCodeLine{00043\ \ \ \ \ assert(is\_valid());}
\DoxyCodeLine{00044\ \ \ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \mbox{\hyperlink{class_conic_a4748d289c87826dae9a38694f3f9fd0d}{Conic}}(\textcolor{keyword}{const}\ Matrix3x2r\&\ numerator\_coeffs,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3x2}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Eigen::Matrix<double,\ 3,\ 1>\&\ denominator\_coeffs,\ \textcolor{comment}{//\ 3}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ConicType\&\ type)}
\DoxyCodeLine{00049\ \ \ \ \ :\ \mbox{\hyperlink{class_rational_function}{RationalFunction}}<2,\ 2>(numerator\_coeffs,\ denominator\_coeffs)}
\DoxyCodeLine{00050\ \ \ \ \ ,\ m\_type(type)}
\DoxyCodeLine{00051\ \ \ \{}
\DoxyCodeLine{00052\ \ \ \ \ assert(is\_valid());}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \mbox{\hyperlink{class_conic_a4748d289c87826dae9a38694f3f9fd0d}{Conic}}(\textcolor{keyword}{const}\ Matrix3x2r\&\ numerator\_coeffs,}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Eigen::Matrix<double,\ 3,\ 1>\&\ denominator\_coeffs,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_interval}{Interval}}\ domain)}
\DoxyCodeLine{00058\ \ \ \ \ :\ \mbox{\hyperlink{class_rational_function}{RationalFunction}}<2,\ 2>(numerator\_coeffs,\ denominator\_coeffs,\ domain)}
\DoxyCodeLine{00059\ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ m\_type\ =\ ConicType::unknown;}
\DoxyCodeLine{00061\ \ \ \ \ assert(is\_valid());}
\DoxyCodeLine{00062\ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \mbox{\hyperlink{class_conic_a4748d289c87826dae9a38694f3f9fd0d}{Conic}}(\textcolor{keyword}{const}\ Matrix3x2r\&\ numerator\_coeffs,}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Eigen::Matrix<double,\ 3,\ 1>\&\ denominator\_coeffs,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_interval}{Interval}}\ domain,}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ConicType\&\ type)}
\DoxyCodeLine{00068\ \ \ \ \ :\ \mbox{\hyperlink{class_rational_function}{RationalFunction}}<2,\ 2>(numerator\_coeffs,\ denominator\_coeffs,\ domain)}
\DoxyCodeLine{00069\ \ \ \ \ ,\ m\_type(type)}
\DoxyCodeLine{00070\ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ assert(is\_valid());}
\DoxyCodeLine{00072\ \ \ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00077\ \ \ ConicType\ \mbox{\hyperlink{class_conic_adbc092cf52b18781a80d04a42b93c263}{get\_type}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{keywordtype}{void}\ transform(\textcolor{keyword}{const}\ Matrix2x2r\&\ rotation,\ \textcolor{keyword}{const}\ PlanarPoint\&\ translation);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{template}<\textcolor{keywordtype}{size\_t}\ dimension>}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordtype}{void}\ pullback\_quadratic\_function(}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{const}\ Eigen::Matrix<double,\ 6,\ dimension>\&\ F\_coeffs,}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{class_rational_function}{RationalFunction<4,\ dimension>}}\&\ pullback\_function)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00085\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00086\ \ \ \ \ SPDLOG\_TRACE(\textcolor{stringliteral}{"{}Pulling\ back\ conic\ by\ quadratic\ function\ \{\}"{}},}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ formatted\_bivariate\_quadratic\_mapping(F\_coeffs));}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ Separate\ the\ individual\ polynomial\ coefficients\ from\ the\ rational}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{comment}{//\ function}}
\DoxyCodeLine{00091\ \ \ \ \ Matrix3x2r\ P\_coeffs\ =\ get\_numerators();}
\DoxyCodeLine{00092\ \ \ \ \ Eigen::Matrix<double,\ 3,\ 1>\ u\_coeffs\ =\ P\_coeffs.col(0);}
\DoxyCodeLine{00093\ \ \ \ \ Eigen::Matrix<double,\ 3,\ 1>\ v\_coeffs\ =\ P\_coeffs.col(1);}
\DoxyCodeLine{00094\ \ \ \ \ Eigen::Matrix<double,\ 3,\ 1>\ Q\_coeffs\ =\ get\_denominator();}
\DoxyCodeLine{00095\ \ \ \ \ SPDLOG\_TRACE(\textcolor{stringliteral}{"{}u\ function\ before\ pullback:\ (\{\})/(\{\})"{}},}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{polynomial__function_8h_a5645bb42a3e7fb1e48deea61f227a065}{formatted\_polynomial}}(u\_coeffs),}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{polynomial__function_8h_a5645bb42a3e7fb1e48deea61f227a065}{formatted\_polynomial}}(Q\_coeffs));}
\DoxyCodeLine{00098\ \ \ \ \ SPDLOG\_TRACE(\textcolor{stringliteral}{"{}v\ function\ before\ pullback:\ (\{\})/(\{\})"{}},}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{polynomial__function_8h_a5645bb42a3e7fb1e48deea61f227a065}{formatted\_polynomial}}(v\_coeffs),}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{polynomial__function_8h_a5645bb42a3e7fb1e48deea61f227a065}{formatted\_polynomial}}(Q\_coeffs));}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ Compute\ (homogenized)\ polynomial\ coefficients\ for\ the\ quadratic\ terms}}
\DoxyCodeLine{00103\ \ \ \ \ Eigen::Matrix<double,\ 5,\ 1>\ QQ\_coeffs,\ Qu\_coeffs,\ Qv\_coeffs,\ uv\_coeffs,}
\DoxyCodeLine{00104\ \ \ \ \ \ \ uu\_coeffs,\ vv\_coeffs;}
\DoxyCodeLine{00105\ \ \ \ \ compute\_polynomial\_mapping\_product<2,\ 2,\ 1>(Q\_coeffs,\ Q\_coeffs,\ QQ\_coeffs);}
\DoxyCodeLine{00106\ \ \ \ \ compute\_polynomial\_mapping\_product<2,\ 2,\ 1>(Q\_coeffs,\ u\_coeffs,\ Qu\_coeffs);}
\DoxyCodeLine{00107\ \ \ \ \ compute\_polynomial\_mapping\_product<2,\ 2,\ 1>(Q\_coeffs,\ v\_coeffs,\ Qv\_coeffs);}
\DoxyCodeLine{00108\ \ \ \ \ compute\_polynomial\_mapping\_product<2,\ 2,\ 1>(u\_coeffs,\ v\_coeffs,\ uv\_coeffs);}
\DoxyCodeLine{00109\ \ \ \ \ compute\_polynomial\_mapping\_product<2,\ 2,\ 1>(u\_coeffs,\ u\_coeffs,\ uu\_coeffs);}
\DoxyCodeLine{00110\ \ \ \ \ compute\_polynomial\_mapping\_product<2,\ 2,\ 1>(v\_coeffs,\ v\_coeffs,\ vv\_coeffs);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ Combine\ quadratic\ monomial\ functions\ into\ a\ matrix}}
\DoxyCodeLine{00113\ \ \ \ \ Eigen::Matrix<double,\ 5,\ 6>\ monomial\_coeffs;}
\DoxyCodeLine{00114\ \ \ \ \ monomial\_coeffs.setZero();}
\DoxyCodeLine{00115\ \ \ \ \ monomial\_coeffs.col(0).head(QQ\_coeffs.size())\ =\ QQ\_coeffs;}
\DoxyCodeLine{00116\ \ \ \ \ monomial\_coeffs.col(1).head(Qu\_coeffs.size())\ =\ Qu\_coeffs;}
\DoxyCodeLine{00117\ \ \ \ \ monomial\_coeffs.col(2).head(Qv\_coeffs.size())\ =\ Qv\_coeffs;}
\DoxyCodeLine{00118\ \ \ \ \ monomial\_coeffs.col(3).head(uv\_coeffs.size())\ =\ uv\_coeffs;}
\DoxyCodeLine{00119\ \ \ \ \ monomial\_coeffs.col(4).head(uu\_coeffs.size())\ =\ uu\_coeffs;}
\DoxyCodeLine{00120\ \ \ \ \ monomial\_coeffs.col(5).head(vv\_coeffs.size())\ =\ vv\_coeffs;}
\DoxyCodeLine{00121\ \ \ \ \ spdlog::trace(\textcolor{stringliteral}{"{}Monomial\ coefficient\ matrix:\(\backslash\)n\{\}"{}},\ monomial\_coeffs);}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ pulled\ back\ rational\ function\ numerator}}
\DoxyCodeLine{00124\ \ \ \ \ spdlog::trace(\textcolor{stringliteral}{"{}Quadratic\ coefficient\ matrix:\(\backslash\)n\{\}"{}},\ F\_coeffs);}
\DoxyCodeLine{00125\ \ \ \ \ Eigen::Matrix<double,\ 5,\ dimension>\ pullback\_coeffs\ =}
\DoxyCodeLine{00126\ \ \ \ \ \ \ monomial\_coeffs\ *\ F\_coeffs;}
\DoxyCodeLine{00127\ \ \ \ \ SPDLOG\_TRACE(\textcolor{stringliteral}{"{}Pullback\ numerator:\ \{\}"{}},}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{polynomial__function_8h_a5645bb42a3e7fb1e48deea61f227a065}{formatted\_polynomial}}(pullback\_coeffs));}
\DoxyCodeLine{00129\ \ \ \ \ SPDLOG\_TRACE(\textcolor{stringliteral}{"{}Pullback\ denominator:\ \{\}"{}},\ \mbox{\hyperlink{polynomial__function_8h_a5645bb42a3e7fb1e48deea61f227a065}{formatted\_polynomial}}(QQ\_coeffs));}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ pullback\_function\ =}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \mbox{\hyperlink{class_rational_function}{RationalFunction<4,\ dimension>}}(pullback\_coeffs,\ QQ\_coeffs,\ domain());}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{keyword}{friend}\ std::ostream\&\ operator<<(std::ostream\&\ out,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_conic}{Conic}}\&\ F);}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00138\ \ \ ConicType\ m\_type;}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{keywordtype}{bool}\ is\_valid()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ std::string\ formatted\_conic()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00143\ \};}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ std::ostream\&}
\DoxyCodeLine{00146\ operator<<(std::ostream\&\ out,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_conic}{Conic}}\&\ F);}

\end{DoxyCode}
