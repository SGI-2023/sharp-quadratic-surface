\doxysection{twelve\+\_\+split\+\_\+spline.\+h}
\hypertarget{twelve__split__spline_8h_source}{}\label{twelve__split__spline_8h_source}\index{src/quadratic\_spline\_surface/twelve\_split\_spline.h@{src/quadratic\_spline\_surface/twelve\_split\_spline.h}}
\mbox{\hyperlink{twelve__split__spline_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ 2023\ Adobe\ Research.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ To\ view\ a\ copy\ of\ the\ license,\ visit\ LICENSE.md.}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}PS12\_patch\_coeffs.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}PS12tri\_bounds\_coeffs.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}common.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{quadratic__spline__surface_8h}{quadratic\_spline\_surface.h}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}igl/per\_vertex\_normals.h"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}line\_segment.h"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{polynomial__function_8h}{polynomial\_function.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}position\_data.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}rational\_function.h"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_twelve_split_spline_surface}{TwelveSplitSplineSurface}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_quadratic_spline_surface}{QuadraticSplineSurface}}}
\DoxyCodeLine{00027\ \{}
\DoxyCodeLine{00028\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \mbox{\hyperlink{class_twelve_split_spline_surface}{TwelveSplitSplineSurface}}(}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{const}\ Eigen::MatrixXd\&\ V,}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_affine_manifold}{AffineManifold}}\&\ affine\_manifold,}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_optimization_parameters}{OptimizationParameters}}\&\ optimization\_params,}
\DoxyCodeLine{00050\ \ \ \ \ std::vector<std::vector<int>>\&\ face\_to\_patch\_indices,}
\DoxyCodeLine{00051\ \ \ \ \ std::vector<int>\&\ patch\_to\_face\_indices,}
\DoxyCodeLine{00052\ \ \ \ \ Eigen::SparseMatrix<double>\&\ fit\_matrix,}
\DoxyCodeLine{00053\ \ \ \ \ Eigen::SparseMatrix<double>\&\ energy\_hessian,}
\DoxyCodeLine{00054\ \ \ \ \ MatrixInverse\&}
\DoxyCodeLine{00055\ \ \ \ \ \ \ energy\_hessian\_inverse);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{class_twelve_split_spline_surface}{TwelveSplitSplineSurface}}(}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<std::array<TriangleCornerFunctionData,\ 3>>\&\ corner\_data,}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<std::array<TriangleMidpointFunctionData,\ 3>>\&}
\DoxyCodeLine{00071\ \ \ \ \ \ \ midpoint\_data,}
\DoxyCodeLine{00072\ \ \ \ \ std::vector<std::vector<int>>\&\ face\_to\_patch\_indices,}
\DoxyCodeLine{00073\ \ \ \ \ std::vector<int>\&\ patch\_to\_face\_indices);}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_twelve_split_spline_surface_a993105e4adc457b53560b1fb0e7e90b6}{update\_positions}}(}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{const}\ Eigen::MatrixXd\&\ V,}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{const}\ Eigen::SparseMatrix<double>\&\ fit\_matrix,}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{const}\ MatrixInverse\&}
\DoxyCodeLine{00085\ \ \ \ \ \ \ energy\_hessian\_inverse);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{class_affine_manifold}{AffineManifold}}\ \textcolor{keyword}{const}\&\ \mbox{\hyperlink{class_twelve_split_spline_surface_a6d2d2bdb7a78fcf86b827c004292ad20}{get\_affine\_manifold}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00091\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_affine\_manifold;}
\DoxyCodeLine{00093\ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00096\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_twelve_split_spline_surface_a987f47261e85e7636a13470edbce5edb}{add\_position\_data\_to\_viewer}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_twelve_split_spline_surface_ae8cd82a6ef2c30e23a13d29fa1cb935a}{clear}}();}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00105\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_twelve_split_spline_surface_a2827ea010a545201f957c82fe41a7db5}{view}}(Eigen::Matrix<double,\ 3,\ 1>\ color\ =\ SKY\_BLUE,}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_subdivisions\ =\ DISCRETIZATION\_LEVEL)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00109\ \ \ \textcolor{keywordtype}{void}\ init\_twelve\_split\_patches(}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<std::array<TriangleCornerFunctionData,\ 3>>\&\ corner\_data,}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<std::array<TriangleMidpointFunctionData,\ 3>>\&}
\DoxyCodeLine{00112\ \ \ \ \ \ \ midpoint\_data,}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<std::array<bool,\ 3>>\&\ is\_cone\_corner,}
\DoxyCodeLine{00114\ \ \ \ \ std::vector<std::vector<int>>\&\ face\_to\_patch\_indices,}
\DoxyCodeLine{00115\ \ \ \ \ std::vector<int>\&\ patch\_to\_face\_indices);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{void}\ generate\_face\_normals(\textcolor{keyword}{const}\ Eigen::MatrixXd\&\ V,}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_affine_manifold}{AffineManifold}}\&\ affine\_manifold,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Eigen::MatrixXd\&\ N);}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{class_affine_manifold}{AffineManifold}}\ m\_affine\_manifold;}
\DoxyCodeLine{00122\ \ \ std::vector<std::array<TriangleCornerFunctionData,\ 3>>\ m\_corner\_data;}
\DoxyCodeLine{00123\ \ \ std::vector<std::array<TriangleMidpointFunctionData,\ 3>>\ m\_midpoint\_data;}
\DoxyCodeLine{00124\ \};}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00130\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00131\ \mbox{\hyperlink{twelve__split__spline_8h_a94b4b68b0d969c6c61ad14e6f3a606a8}{generate\_twelve\_split\_spline\_patch\_patch\_boundaries}}(}
\DoxyCodeLine{00132\ \ \ std::array<std::array<Eigen::Matrix<double,\ 3,\ 1>,\ 3>,\ 12>\&\ patch\_boundaries);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00139\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00140\ \mbox{\hyperlink{twelve__split__spline_8h_a8a8ffe7d4cf608fcd5c6a1230bd84311}{generate\_twelve\_split\_spline\_patch\_patch\_to\_corner\_map}}(}
\DoxyCodeLine{00141\ \ \ std::array<std::pair<int,\ int>,\ 12>\&\ patch\_to\_corner\_map);}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00150\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00151\ \mbox{\hyperlink{twelve__split__spline_8h_ab332c8bc594198dab3f92a85adb9abd6}{generate\_twelve\_split\_domain\_areas}}(\textcolor{keyword}{const}\ PlanarPoint\&\ v0,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ PlanarPoint\&\ v1,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ PlanarPoint\&\ v2,}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::array<double,\ 12>\&\ patch\_areas);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00159\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar>}
\DoxyCodeLine{00160\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00161\ \mbox{\hyperlink{twelve__split__spline_8h_a938e2e2bdf0f08d8e84250043b415e5c}{generate\_twelve\_split\_data\_to\_monomial\_matrices}}(}
\DoxyCodeLine{00162\ \ \ std::array<Eigen::Matrix<Scalar,\ 6,\ 12>,\ 12>\&\ coefficient\_matrices)}
\DoxyCodeLine{00163\ \{}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordtype}{double}\ patch\_coeffs[12][6][12];}
\DoxyCodeLine{00165\ \ \ PS12\_patch\_coeffs(patch\_coeffs);}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ 12;\ ++i)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ 6;\ ++j)\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ k\ =\ 0;\ k\ <\ 12;\ ++k)\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ coefficient\_matrices[i](j,\ k)\ =\ Scalar(patch\_coeffs[i][j][k]);}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00171\ \ \ \ \ \}}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00180\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00181\ \mbox{\hyperlink{twelve__split__spline_8h_abf6c5fce334eae5c288e4b6c0d96fabf}{compute\_twelve\_split\_spline\_patch\_boundary\_edges}}(}
\DoxyCodeLine{00182\ \ \ \textcolor{keyword}{const}\ Eigen::MatrixXi\&\ F,}
\DoxyCodeLine{00183\ \ \ \textcolor{keyword}{const}\ std::vector<std::vector<int>>\&\ face\_to\_patch\_indices,}
\DoxyCodeLine{00184\ \ \ std::vector<std::pair<int,\ int>>\&\ patch\_boundary\_edges);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00193\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar>}
\DoxyCodeLine{00194\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00195\ \mbox{\hyperlink{twelve__split__spline_8h_ade56b129ed06a782af24ae37e3051908}{generate\_twelve\_split\_data\_matrix}}(}
\DoxyCodeLine{00196\ \ \ \textcolor{keyword}{const}\ std::array<\mbox{\hyperlink{struct_triangle_corner_data}{TriangleCornerData}}<Eigen::Matrix<Scalar,\ 1,\ 3>>,\ 3>\&}
\DoxyCodeLine{00197\ \ \ \ \ corner\_data,}
\DoxyCodeLine{00198\ \ \ \textcolor{keyword}{const}\ std::array<\mbox{\hyperlink{struct_triangle_midpoint_data}{TriangleMidpointData}}<Eigen::Matrix<Scalar,\ 1,\ 3>>,\ 3>\&}
\DoxyCodeLine{00199\ \ \ \ \ midpoint\_data,}
\DoxyCodeLine{00200\ \ \ Eigen::Matrix<Scalar,\ 12,\ 3>\&\ twelve\_split\_data)}
\DoxyCodeLine{00201\ \{}
\DoxyCodeLine{00202\ \ \ \textcolor{comment}{//\ Vertex\ positions}}
\DoxyCodeLine{00203\ \ \ twelve\_split\_data.row(0)\ =\ corner\_data[0].function\_value;}
\DoxyCodeLine{00204\ \ \ twelve\_split\_data.row(1)\ =\ corner\_data[1].function\_value;}
\DoxyCodeLine{00205\ \ \ twelve\_split\_data.row(2)\ =\ corner\_data[2].function\_value;}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \textcolor{comment}{//\ Vertex\ gradients}}
\DoxyCodeLine{00208\ \ \ twelve\_split\_data.row(3)\ =\ corner\_data[0].first\_edge\_derivative;}
\DoxyCodeLine{00209\ \ \ twelve\_split\_data.row(4)\ =\ corner\_data[0].second\_edge\_derivative;}
\DoxyCodeLine{00210\ \ \ twelve\_split\_data.row(5)\ =\ corner\_data[1].second\_edge\_derivative;}
\DoxyCodeLine{00211\ \ \ twelve\_split\_data.row(6)\ =\ corner\_data[1].first\_edge\_derivative;}
\DoxyCodeLine{00212\ \ \ twelve\_split\_data.row(7)\ =\ corner\_data[2].first\_edge\_derivative;}
\DoxyCodeLine{00213\ \ \ twelve\_split\_data.row(8)\ =\ corner\_data[2].second\_edge\_derivative;}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \textcolor{comment}{//\ Edge\ midpoint\ normals\ in\ order\ ij,\ jk,\ ki}}
\DoxyCodeLine{00216\ \ \ twelve\_split\_data.row(9)\ =\ midpoint\_data[2].normal\_derivative;}
\DoxyCodeLine{00217\ \ \ twelve\_split\_data.row(10)\ =\ midpoint\_data[0].normal\_derivative;}
\DoxyCodeLine{00218\ \ \ twelve\_split\_data.row(11)\ =\ midpoint\_data[1].normal\_derivative;}
\DoxyCodeLine{00219\ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00228\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Scalar>}
\DoxyCodeLine{00229\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00230\ \mbox{\hyperlink{twelve__split__spline_8h_aad6873053392b5bc4e9639694bc03a8b}{generate\_twelve\_split\_spline\_patch\_surface\_mapping}}(}
\DoxyCodeLine{00231\ \ \ \textcolor{keyword}{const}\ std::array<\mbox{\hyperlink{struct_triangle_corner_data}{TriangleCornerData}}<Eigen::Matrix<Scalar,\ 1,\ 3>>,\ 3>\&}
\DoxyCodeLine{00232\ \ \ \ \ corner\_data,}
\DoxyCodeLine{00233\ \ \ \textcolor{keyword}{const}\ std::array<\mbox{\hyperlink{struct_triangle_midpoint_data}{TriangleMidpointData}}<Eigen::Matrix<Scalar,\ 1,\ 3>>,\ 3>\&}
\DoxyCodeLine{00234\ \ \ \ \ midpoint\_data,}
\DoxyCodeLine{00235\ \ \ std::array<Eigen::Matrix<Scalar,\ 6,\ 3>,\ 12>\&\ surface\_mappings)}
\DoxyCodeLine{00236\ \{}
\DoxyCodeLine{00237\ \ \ \textcolor{comment}{//\ Generate\ matrices\ to\ go\ from\ the\ position\ data\ to\ surface\ coefficients}}
\DoxyCodeLine{00238\ \ \ std::array<Eigen::Matrix<Scalar,\ 6,\ 12>,\ 12>\ coefficient\_matrices;}
\DoxyCodeLine{00239\ \ \ generate\_twelve\_split\_data\_to\_monomial\_matrices<Scalar>(coefficient\_matrices);}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \textcolor{comment}{//\ Combine\ position\ data\ into\ a\ matrix}}
\DoxyCodeLine{00242\ \ \ Eigen::Matrix<Scalar,\ 12,\ 3>\ twelve\_split\_data;}
\DoxyCodeLine{00243\ \ \ generate\_twelve\_split\_data\_matrix<Scalar>(}
\DoxyCodeLine{00244\ \ \ \ \ corner\_data,\ midpoint\_data,\ twelve\_split\_data);}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \textcolor{comment}{//\ Build\ the\ surface\ mappings}}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ 12;\ ++i)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ surface\_mappings[i]\ =\ coefficient\_matrices[i]\ *\ twelve\_split\_data;}
\DoxyCodeLine{00249\ \ \ \}}
\DoxyCodeLine{00250\ \}}

\end{DoxyCode}
