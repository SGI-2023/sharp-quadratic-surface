\doxysection{test\+\_\+optimize\+\_\+spline\+\_\+surface.\+cpp}
\hypertarget{test__optimize__spline__surface_8cpp_source}{}\label{test__optimize__spline__surface_8cpp_source}\index{src/tests/test\_optimize\_spline\_surface.cpp@{src/tests/test\_optimize\_spline\_surface.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ <catch2/catch\_test\_macros.hpp>}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}common.h"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}generate\_shapes.h"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{optimize__spline__surface_8h}{optimize\_spline\_surface.h}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <fenv.h>}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{comment}{//void\ build\_corner\_variables(}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ \ const\ MatrixXr\ \&P,}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ \ const\ MatrixXr\ \&G,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ \ DynamicVector3v\ \&pi,}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ \ DynamicVector3v\ \&pj,}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ \ DynamicVector3v\ \&pk,}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ \ DynamicMatrix2x3v\ \&Gi}}
\DoxyCodeLine{00016\ \textcolor{comment}{//)\ \{}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ \ build\_independent\_variable\_vector<DynamicVar,\ DynamicVector3v>(P.row(0),\ pi,\ 0,\ 15);}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ \ build\_independent\_variable\_vector<DynamicVar,\ DynamicVector3v>(P.row(1),\ pj,\ 3,\ 15);}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ \ build\_independent\_variable\_vector<DynamicVar,\ DynamicVector3v>(P.row(2),\ pk,\ 6,\ 15);}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ \ build\_independent\_variable\_matrix<DynamicVar,\ DynamicMatrix2x3v>(G,\ Gi,\ 9,\ 15);}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00022\ \textcolor{comment}{//}}
\DoxyCodeLine{00023\ \textcolor{comment}{//}}
\DoxyCodeLine{00024\ \textcolor{comment}{//void\ build\_triangle\_variables(}}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ \ const\ MatrixXr\ \&P,}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ \ const\ MatrixXr\ \&G,}}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ \ DynamicVector3v\ \&pi,}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ \ DynamicVector3v\ \&pj,}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\ \ DynamicVector3v\ \&pk,}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ \ DynamicMatrix2x3v\ \&Gi,}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ \ DynamicMatrix2x3v\ \&Gj,}}
\DoxyCodeLine{00032\ \textcolor{comment}{//\ \ DynamicMatrix2x3v\ \&Gk}}
\DoxyCodeLine{00033\ \textcolor{comment}{//)\ \{}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ \ build\_independent\_variable\_vector<DynamicVar,\ DynamicVector3v>(P.row(0),\ pi,\ 0,\ 27);}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ \ build\_independent\_variable\_vector<DynamicVar,\ DynamicVector3v>(P.row(1),\ pj,\ 3,\ 27);}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ \ build\_independent\_variable\_vector<DynamicVar,\ DynamicVector3v>(P.row(2),\ pk,\ 6,\ 27);}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ \ build\_independent\_variable\_matrix<DynamicVar,\ DynamicMatrix2x3v>(G.block(0,\ 0,\ 2,\ 3),\ Gi,\ 9,\ 27);}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ \ build\_independent\_variable\_matrix<DynamicVar,\ DynamicMatrix2x3v>(G.block(2,\ 0,\ 2,\ 3),\ Gj,\ 15,\ 27);}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ \ build\_independent\_variable\_matrix<DynamicVar,\ DynamicMatrix2x3v>(G.block(4,\ 0,\ 2,\ 3),\ Gk,\ 21,\ 27);}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{comment}{//\ 2u\string^2\ +\ v\string^2}}
\DoxyCodeLine{00043\ \textcolor{keywordtype}{void}\ build\_quadratic\_biharmonic\_square(}
\DoxyCodeLine{00044\ \ \ MatrixXr\ \&V,}
\DoxyCodeLine{00045\ \ \ std::vector<Matrix2x3r>\ \&gradients,}
\DoxyCodeLine{00046\ \ \ std::vector<std::vector<MatrixXr>>\ \&layout}
\DoxyCodeLine{00047\ )\ \{}
\DoxyCodeLine{00048\ \ \ V.resize(5,\ 3);}
\DoxyCodeLine{00049\ \ \ V\ <<}
\DoxyCodeLine{00050\ \ \ \ \ 0,\ 0,\ 0,}
\DoxyCodeLine{00051\ \ \ \ \ 2,\ 0,\ 8,}
\DoxyCodeLine{00052\ \ \ \ \ 2,\ 2,\ 12,}
\DoxyCodeLine{00053\ \ \ \ \ 0,\ 2,\ 4,}
\DoxyCodeLine{00054\ \ \ \ \ 1,\ 1,\ 3;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ Eigen::MatrixXi\ F(4,\ 3);}
\DoxyCodeLine{00057\ \ \ F\ <<}
\DoxyCodeLine{00058\ \ \ \ \ 0,\ 1,\ 4,}
\DoxyCodeLine{00059\ \ \ \ \ 1,\ 2,\ 4,}
\DoxyCodeLine{00060\ \ \ \ \ 2,\ 3,\ 4,}
\DoxyCodeLine{00061\ \ \ \ \ 3,\ 0,\ 4;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ layout.resize(4);}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ face\_index\ =\ 0;\ face\_index\ <\ 4;\ ++face\_index)}
\DoxyCodeLine{00065\ \ \ \{}
\DoxyCodeLine{00066\ \ \ \ \ layout[face\_index].resize(3);}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ vertex\_index\ =\ 0;\ vertex\_index\ <\ 3;\ ++vertex\_index)}
\DoxyCodeLine{00068\ \ \ \ \ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ F(face\_index,\ vertex\_index);}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ j\ =\ F(face\_index,\ (vertex\_index\ +\ 1)\ \%\ 3);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ k\ =\ F(face\_index,\ (vertex\_index\ +\ 2)\ \%\ 3);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ VectorXr\ vi\ =\ V.row(i);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ VectorXr\ vj\ =\ V.row(j);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ VectorXr\ vk\ =\ V.row(k);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ layout[face\_index][vertex\_index].resize(2,\ 2);}
\DoxyCodeLine{00078\ \ \ \ \ \ \ layout[face\_index][vertex\_index](0,0)\ =\ vj(0)\ -\/\ vi(0);}
\DoxyCodeLine{00079\ \ \ \ \ \ \ layout[face\_index][vertex\_index](0,1)\ =\ vj(1)\ -\/\ vi(1);}
\DoxyCodeLine{00080\ \ \ \ \ \ \ layout[face\_index][vertex\_index](1,0)\ =\ vk(0)\ -\/\ vi(0);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ layout[face\_index][vertex\_index](1,1)\ =\ vk(1)\ -\/\ vi(1);}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ gradients.resize(5);}
\DoxyCodeLine{00086\ \ \ gradients[0]\ <<}
\DoxyCodeLine{00087\ \ \ \ \ 1,\ 0,\ 0,}
\DoxyCodeLine{00088\ \ \ \ \ 0,\ 1,\ 0;}
\DoxyCodeLine{00089\ \ \ gradients[1]\ <<}
\DoxyCodeLine{00090\ \ \ \ \ 1,\ 0,\ 8,}
\DoxyCodeLine{00091\ \ \ \ \ 0,\ 1,\ 0;}
\DoxyCodeLine{00092\ \ \ gradients[2]\ <<}
\DoxyCodeLine{00093\ \ \ \ \ 1,\ 0,\ 8,}
\DoxyCodeLine{00094\ \ \ \ \ 0,\ 1,\ 4;}
\DoxyCodeLine{00095\ \ \ gradients[3]\ <<}
\DoxyCodeLine{00096\ \ \ \ \ 1,\ 0,\ 0,}
\DoxyCodeLine{00097\ \ \ \ \ 0,\ 1,\ 4;}
\DoxyCodeLine{00098\ \ \ gradients[4]\ <<}
\DoxyCodeLine{00099\ \ \ \ \ 1,\ 0,\ 4,}
\DoxyCodeLine{00100\ \ \ \ \ 0,\ 1,\ 2;}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ SpatialVector\ quadratic\_torus\_point(}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordtype}{double}\ u,}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordtype}{double}\ v,}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordtype}{double}\ R1=5.0,}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordtype}{double}\ R2=1.0}
\DoxyCodeLine{00108\ )\ \{}
\DoxyCodeLine{00109\ \ \ SpatialVector\ point(3);}
\DoxyCodeLine{00110\ \ \ point\ <<}
\DoxyCodeLine{00111\ \ \ \ \ R1\ *\ (1\ -\/\ (u\ *\ u\ /\ 2))\ +\ R2\ *\ (1\ -\/\ (v\ *\ v\ /\ 2)\ -\/\ (u\ *\ u\ /\ 2)),}
\DoxyCodeLine{00112\ \ \ \ \ (R1\ +\ R2)\ *\ u,}
\DoxyCodeLine{00113\ \ \ \ \ R2\ *\ v;}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{return}\ point;}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ Matrix2x3r\ quadratic\_torus\_gradient(}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordtype}{double}\ u,}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordtype}{double}\ v,}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordtype}{double}\ R1=5.0,}
\DoxyCodeLine{00121\ \ \ \textcolor{keywordtype}{double}\ R2=1.0}
\DoxyCodeLine{00122\ )\ \{}
\DoxyCodeLine{00123\ \ \ Matrix2x3r\ gradient(2,\ 3);}
\DoxyCodeLine{00124\ \ \ gradient\ <<}
\DoxyCodeLine{00125\ \ \ \ \ -\/R1\ *\ u\ -\/\ R2\ *\ u,\ (R1\ +\ R2),\ \ 0,}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/R2\ *\ v,\ \ \ \ \ \ \ \ \ 0,\ R2;}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \textcolor{keywordflow}{return}\ gradient;}
\DoxyCodeLine{00129\ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{void}\ build\_quadratic\_torus\_square(}
\DoxyCodeLine{00133\ \ \ MatrixXr\ \&V,}
\DoxyCodeLine{00134\ \ \ std::vector<Matrix2x3r>\ \&gradients,}
\DoxyCodeLine{00135\ \ \ std::vector<std::vector<MatrixXr>>\ \&layout}
\DoxyCodeLine{00136\ )\ \{}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordtype}{double}\ pi\ =\ M\_PI;}
\DoxyCodeLine{00138\ \ \ V.resize(5,\ 3);}
\DoxyCodeLine{00139\ \ \ V.row(0)\ =\ quadratic\_torus\_point(-\/pi/4.0,\ -\/pi/2.0);}
\DoxyCodeLine{00140\ \ \ V.row(1)\ =\ quadratic\_torus\_point(\ pi/4.0,\ -\/pi/2.0);}
\DoxyCodeLine{00141\ \ \ V.row(2)\ =\ quadratic\_torus\_point(\ pi/4.0,\ \ pi/2.0);}
\DoxyCodeLine{00142\ \ \ V.row(3)\ =\ quadratic\_torus\_point(-\/pi/4.0,\ \ pi/2.0);}
\DoxyCodeLine{00143\ \ \ V.row(4)\ =\ quadratic\_torus\_point(0.0,\ 0.0);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ Eigen::MatrixXi\ F(4,\ 3);}
\DoxyCodeLine{00146\ \ \ F\ <<}
\DoxyCodeLine{00147\ \ \ \ \ 0,\ 1,\ 4,}
\DoxyCodeLine{00148\ \ \ \ \ 1,\ 2,\ 4,}
\DoxyCodeLine{00149\ \ \ \ \ 2,\ 3,\ 4,}
\DoxyCodeLine{00150\ \ \ \ \ 3,\ 0,\ 4;}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ MatrixXr\ U(5,\ 2);}
\DoxyCodeLine{00153\ \ \ U\ <<}
\DoxyCodeLine{00154\ \ \ \ \ -\/pi/4.0,\ -\/pi/2.0,}
\DoxyCodeLine{00155\ \ \ \ \ \ pi/4.0,\ -\/pi/2.0,}
\DoxyCodeLine{00156\ \ \ \ \ \ pi/4.0,\ \ pi/2.0,}
\DoxyCodeLine{00157\ \ \ \ \ -\/pi/4.0,\ \ pi/2.0,}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ 0.0,\ \ \ \ \ 0.0;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ layout.resize(4);}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ face\_index\ =\ 0;\ face\_index\ <\ 4;\ ++face\_index)}
\DoxyCodeLine{00162\ \ \ \{}
\DoxyCodeLine{00163\ \ \ \ \ layout[face\_index].resize(3);}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ vertex\_index\ =\ 0;\ vertex\_index\ <\ 3;\ ++vertex\_index)}
\DoxyCodeLine{00165\ \ \ \ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ F(face\_index,\ vertex\_index);}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ j\ =\ F(face\_index,\ (vertex\_index\ +\ 1)\ \%\ 3);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ k\ =\ F(face\_index,\ (vertex\_index\ +\ 2)\ \%\ 3);}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \ \ PlanarPoint\ ui\ =\ U.row(i);}
\DoxyCodeLine{00171\ \ \ \ \ \ \ PlanarPoint\ uj\ =\ U.row(j);}
\DoxyCodeLine{00172\ \ \ \ \ \ \ PlanarPoint\ uk\ =\ U.row(k);}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ layout[face\_index][vertex\_index].resize(2,\ 2);}
\DoxyCodeLine{00175\ \ \ \ \ \ \ layout[face\_index][vertex\_index](0,0)\ =\ uj(0)\ -\/\ ui(0);}
\DoxyCodeLine{00176\ \ \ \ \ \ \ layout[face\_index][vertex\_index](0,1)\ =\ uj(1)\ -\/\ ui(1);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ layout[face\_index][vertex\_index](1,0)\ =\ uk(0)\ -\/\ ui(0);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ layout[face\_index][vertex\_index](1,1)\ =\ uk(1)\ -\/\ ui(1);}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ gradients.resize(5);}
\DoxyCodeLine{00183\ \ \ gradients[0].resize(3,\ 2);}
\DoxyCodeLine{00184\ \ \ gradients[0]\ =\ quadratic\_torus\_gradient(-\/pi/4.0,\ -\/pi/2.0);}
\DoxyCodeLine{00185\ \ \ gradients[1]\ =\ quadratic\_torus\_gradient(\ pi/4.0,\ -\/pi/2.0);}
\DoxyCodeLine{00186\ \ \ gradients[2]\ =\ quadratic\_torus\_gradient(\ pi/4.0,\ \ pi/2.0);}
\DoxyCodeLine{00187\ \ \ gradients[3]\ =\ quadratic\_torus\_gradient(-\/pi/4.0,\ \ pi/2.0);}
\DoxyCodeLine{00188\ \ \ gradients[4]\ =\ quadratic\_torus\_gradient(0.0,\ 0.0);}
\DoxyCodeLine{00189\ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \textcolor{comment}{//\ u\string^3\ +\ v\string^3}}
\DoxyCodeLine{00192\ \textcolor{keywordtype}{void}\ build\_cubic\_biharmonic\_square(}
\DoxyCodeLine{00193\ \ \ MatrixXr\ \&V,}
\DoxyCodeLine{00194\ \ \ std::vector<Matrix2x3r>\ \&gradients,}
\DoxyCodeLine{00195\ \ \ std::vector<std::vector<MatrixXr>>\ \&layout}
\DoxyCodeLine{00196\ )\ \{}
\DoxyCodeLine{00197\ \ \ V.resize(5,\ 3);}
\DoxyCodeLine{00198\ \ \ V\ <<}
\DoxyCodeLine{00199\ \ \ \ \ 0,\ 0,\ 0,}
\DoxyCodeLine{00200\ \ \ \ \ 2,\ 0,\ 8,}
\DoxyCodeLine{00201\ \ \ \ \ 2,\ 2,\ 16,}
\DoxyCodeLine{00202\ \ \ \ \ 0,\ 2,\ 8,}
\DoxyCodeLine{00203\ \ \ \ \ 1,\ 1,\ 2;}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ Eigen::VectorXi\ F(4,\ 3);}
\DoxyCodeLine{00206\ \ \ F\ <<}
\DoxyCodeLine{00207\ \ \ \ \ 0,\ 1,\ 4,}
\DoxyCodeLine{00208\ \ \ \ \ 1,\ 2,\ 4,}
\DoxyCodeLine{00209\ \ \ \ \ 2,\ 3,\ 4,}
\DoxyCodeLine{00210\ \ \ \ \ 3,\ 0,\ 4;}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ layout.resize(4);}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ face\_index\ =\ 0;\ face\_index\ <\ 4;\ ++face\_index)}
\DoxyCodeLine{00214\ \ \ \{}
\DoxyCodeLine{00215\ \ \ \ \ layout[face\_index].resize(3);}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ 3;\ ++i)}
\DoxyCodeLine{00217\ \ \ \ \ \{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ j\ =\ (i\ +\ 1)\ \%\ 3;}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ k\ =\ (i\ +\ 2)\ \%\ 3;}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \ \ SpatialVector\ vi\ =\ V.row(i);}
\DoxyCodeLine{00222\ \ \ \ \ \ \ SpatialVector\ vj\ =\ V.row(j);}
\DoxyCodeLine{00223\ \ \ \ \ \ \ SpatialVector\ vk\ =\ V.row(k);}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \ \ layout[face\_index][i].resize(2,\ 2);}
\DoxyCodeLine{00226\ \ \ \ \ \ \ layout[face\_index][i](0,0)\ =\ vj(0)\ -\/\ vi(0);}
\DoxyCodeLine{00227\ \ \ \ \ \ \ layout[face\_index][i](0,1)\ =\ vj(1)\ -\/\ vi(1);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ layout[face\_index][i](1,0)\ =\ vk(0)\ -\/\ vi(0);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ layout[face\_index][i](1,1)\ =\ vk(1)\ -\/\ vi(1);}
\DoxyCodeLine{00230\ \ \ \ \ \}}
\DoxyCodeLine{00231\ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ gradients.resize(5);}
\DoxyCodeLine{00234\ \ \ gradients[0]\ <<}
\DoxyCodeLine{00235\ \ \ \ \ 1,\ 0,\ 0,}
\DoxyCodeLine{00236\ \ \ \ \ 0,\ 1,\ 0;}
\DoxyCodeLine{00237\ \ \ gradients[1]\ <<}
\DoxyCodeLine{00238\ \ \ \ \ 1,\ 0,\ 12,}
\DoxyCodeLine{00239\ \ \ \ \ 0,\ 1,\ 0;}
\DoxyCodeLine{00240\ \ \ gradients[2]\ <<}
\DoxyCodeLine{00241\ \ \ \ \ 1,\ 0,\ 12,}
\DoxyCodeLine{00242\ \ \ \ \ 0,\ 1,\ 12;}
\DoxyCodeLine{00243\ \ \ gradients[3]\ <<}
\DoxyCodeLine{00244\ \ \ \ \ 1,\ 0,\ 0,}
\DoxyCodeLine{00245\ \ \ \ \ 0,\ 1,\ 12;}
\DoxyCodeLine{00246\ \ \ gradients[4]\ <<}
\DoxyCodeLine{00247\ \ \ \ \ 1,\ 0,\ 3,}
\DoxyCodeLine{00248\ \ \ \ \ 0,\ 1,\ 3;}
\DoxyCodeLine{00249\ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ TEST\_CASE\ (\ \textcolor{stringliteral}{"{}Single\ triangle\ affine\ manifold\ energy\ can\ be\ computed"{}},\ \textcolor{stringliteral}{"{}[optimize\_spline\_surface]"{}})}
\DoxyCodeLine{00253\ \{}
\DoxyCodeLine{00254\ \ \ MatrixXr\ initial\_V(3,\ 3);}
\DoxyCodeLine{00255\ \ \ std::vector<Matrix2x3r>\ initial\_gradients(3);}
\DoxyCodeLine{00256\ \ \ }
\DoxyCodeLine{00257\ \ \ MatrixXr\ optimized\_V;}
\DoxyCodeLine{00258\ \ \ std::vector<Matrix2x3r>\ optimized\_gradients;}
\DoxyCodeLine{00259\ \ \ std::vector<size\_t>\ variable\_vertices;}
\DoxyCodeLine{00260\ \ \ arange(initial\_V.rows(),\ variable\_vertices);}
\DoxyCodeLine{00261\ \ \ \mbox{\hyperlink{struct_optimization_parameters}{OptimizationParameters}}\ optimization\_params;}
\DoxyCodeLine{00262\ \ \ \textcolor{comment}{//optimization\_params.least\_squares\_factor\ =\ 1.0;}}
\DoxyCodeLine{00263\ \ \ optimization\_params.position\_difference\_factor\ =\ 1.0;}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \textcolor{comment}{//\ Initialize\ equilateral\ triangle\ affine\ manifold}}
\DoxyCodeLine{00266\ \ \ Eigen::MatrixXi\ F(1,\ 3);}
\DoxyCodeLine{00267\ \ \ std::vector<std::vector<double>>\ l(1);}
\DoxyCodeLine{00268\ \ \ F\ <<\ 0,\ 1,\ 2;}
\DoxyCodeLine{00269\ \ \ \textcolor{comment}{//l[0]\ =\ \{\ sqrt(2.0),\ 1.0,\ 1.0\ \};}}
\DoxyCodeLine{00270\ \ \ \textcolor{comment}{//AffineManifold\ affine\_manifold(F,\ l);}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ SECTION\ (\ \textcolor{stringliteral}{"{}Zero"{}}\ )}
\DoxyCodeLine{00273\ \ \ \{}
\DoxyCodeLine{00274\ \textcolor{comment}{//\ \ \ \ initial\_V\ <<\ }}
\DoxyCodeLine{00275\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00276\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00277\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00278\ \textcolor{comment}{//\ \ \ \ initial\_gradients[0]\ <<}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00280\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00281\ \textcolor{comment}{//\ \ \ \ initial\_gradients[1]\ <<}}
\DoxyCodeLine{00282\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00283\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00284\ \textcolor{comment}{//\ \ \ \ initial\_gradients[2]\ <<}}
\DoxyCodeLine{00285\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00286\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00287\ \textcolor{comment}{//}}
\DoxyCodeLine{00288\ \textcolor{comment}{//\ \ \ \ double\ energy\ =\ optimize\_six\_split\_spline\_surface(}}
\DoxyCodeLine{00289\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00290\ \textcolor{comment}{//\ \ \ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00291\ \textcolor{comment}{//\ \ \ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00292\ \textcolor{comment}{//\ \ \ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00293\ \textcolor{comment}{//\ \ \ \ \ \ optimization\_params,}}
\DoxyCodeLine{00294\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_V,}}
\DoxyCodeLine{00295\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00296\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00297\ \textcolor{comment}{//}}
\DoxyCodeLine{00298\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Zero\ edge\ energy:\ \{\}"{},\ energy);}}
\DoxyCodeLine{00299\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ float\_equal(energy,\ 0.0)\ );}}
\DoxyCodeLine{00300\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(initial\_V,\ optimized\_V)\ );}}
\DoxyCodeLine{00301\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(initial\_gradients[0],\ optimized\_gradients[0])\ );}}
\DoxyCodeLine{00302\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(initial\_gradients[1],\ optimized\_gradients[1])\ );}}
\DoxyCodeLine{00303\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(initial\_gradients[2],\ optimized\_gradients[2])\ );}}
\DoxyCodeLine{00304\ \ \ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ SECTION\ (\ \textcolor{stringliteral}{"{}Zero\ with\ random\ gradients"{}}\ )}
\DoxyCodeLine{00307\ \ \ \{}
\DoxyCodeLine{00308\ \textcolor{comment}{//\ \ \ \ initial\_V\ <<\ }}
\DoxyCodeLine{00309\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00310\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00311\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00312\ \textcolor{comment}{//\ \ \ \ initial\_gradients[0]\ <<}}
\DoxyCodeLine{00313\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 1,\ 3,}}
\DoxyCodeLine{00314\ \textcolor{comment}{//\ \ \ \ \ \ 9,\ 2,\ 1;}}
\DoxyCodeLine{00315\ \textcolor{comment}{//\ \ \ \ initial\_gradients[1]\ <<}}
\DoxyCodeLine{00316\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 1,\ 6,}}
\DoxyCodeLine{00317\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 2,\ 1;}}
\DoxyCodeLine{00318\ \textcolor{comment}{//\ \ \ \ initial\_gradients[2]\ <<}}
\DoxyCodeLine{00319\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 2,\ 1,}}
\DoxyCodeLine{00320\ \textcolor{comment}{//\ \ \ \ \ \ 3,\ 1,\ 3;}}
\DoxyCodeLine{00321\ \textcolor{comment}{//\ \ \ \ Matrix2x3r\ expected\_gradient(2,\ 3);}}
\DoxyCodeLine{00322\ \textcolor{comment}{//\ \ \ \ expected\_gradient\ <<}}
\DoxyCodeLine{00323\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00324\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00325\ \textcolor{comment}{//}}
\DoxyCodeLine{00326\ \textcolor{comment}{//\ \ \ \ double\ energy\ =\ optimize\_six\_split\_spline\_surface(}}
\DoxyCodeLine{00327\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00328\ \textcolor{comment}{//\ \ \ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00329\ \textcolor{comment}{//\ \ \ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00330\ \textcolor{comment}{//\ \ \ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00331\ \textcolor{comment}{//\ \ \ \ \ \ optimization\_params,}}
\DoxyCodeLine{00332\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_V,}}
\DoxyCodeLine{00333\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00334\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00335\ \textcolor{comment}{//}}
\DoxyCodeLine{00336\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Zero\ edge\ energy:\ \{\}"{},\ energy);}}
\DoxyCodeLine{00337\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Optimized\ gradients:\(\backslash\)n\{\}"{},\ formatted\_vector(optimized\_gradients));}}
\DoxyCodeLine{00338\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ float\_equal(energy,\ 0.0)\ );}}
\DoxyCodeLine{00339\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(initial\_V,\ optimized\_V)\ );}}
\DoxyCodeLine{00340\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(expected\_gradient,\ optimized\_gradients[0])\ );}}
\DoxyCodeLine{00341\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(expected\_gradient,\ optimized\_gradients[1])\ );}}
\DoxyCodeLine{00342\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(expected\_gradient,\ optimized\_gradients[2])\ );}}
\DoxyCodeLine{00343\ \ \ \}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ SECTION\ (\ \textcolor{stringliteral}{"{}Planar\ triangle"{}}\ )}
\DoxyCodeLine{00346\ \ \ \{}
\DoxyCodeLine{00347\ \textcolor{comment}{//\ \ \ \ initial\_V\ <<\ }}
\DoxyCodeLine{00348\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00349\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 0,\ 0,}}
\DoxyCodeLine{00350\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 1,\ 0;}}
\DoxyCodeLine{00351\ \textcolor{comment}{//\ \ \ \ initial\_gradients[0]\ <<}}
\DoxyCodeLine{00352\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 1,\ 3,}}
\DoxyCodeLine{00353\ \textcolor{comment}{//\ \ \ \ \ \ 9,\ 2,\ 1;}}
\DoxyCodeLine{00354\ \textcolor{comment}{//\ \ \ \ initial\_gradients[1]\ <<}}
\DoxyCodeLine{00355\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 1,\ 6,}}
\DoxyCodeLine{00356\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 2,\ 1;}}
\DoxyCodeLine{00357\ \textcolor{comment}{//\ \ \ \ initial\_gradients[2]\ <<}}
\DoxyCodeLine{00358\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 2,\ 1,}}
\DoxyCodeLine{00359\ \textcolor{comment}{//\ \ \ \ \ \ 3,\ 1,\ 3;}}
\DoxyCodeLine{00360\ \textcolor{comment}{//\ \ \ \ Matrix2x3r\ expected\_gradient(2,\ 3);}}
\DoxyCodeLine{00361\ \textcolor{comment}{//\ \ \ \ expected\_gradient\ <<}}
\DoxyCodeLine{00362\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 0,\ 0,}}
\DoxyCodeLine{00363\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 1,\ 0;}}
\DoxyCodeLine{00364\ \textcolor{comment}{//}}
\DoxyCodeLine{00365\ \textcolor{comment}{//\ \ \ \ double\ energy\ =\ optimize\_six\_split\_spline\_surface(}}
\DoxyCodeLine{00366\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00367\ \textcolor{comment}{//\ \ \ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00368\ \textcolor{comment}{//\ \ \ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00369\ \textcolor{comment}{//\ \ \ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00370\ \textcolor{comment}{//\ \ \ \ \ \ optimization\_params,}}
\DoxyCodeLine{00371\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_V,}}
\DoxyCodeLine{00372\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00373\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00374\ \textcolor{comment}{//}}
\DoxyCodeLine{00375\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Zero\ edge\ energy:\ \{\}"{},\ energy);}}
\DoxyCodeLine{00376\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Optimized\ gradients:\(\backslash\)n\{\}"{},\ formatted\_vector(optimized\_gradients));}}
\DoxyCodeLine{00377\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ float\_equal(energy,\ 0.0)\ );}}
\DoxyCodeLine{00378\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(initial\_V,\ optimized\_V)\ );}}
\DoxyCodeLine{00379\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ matrix\_equal(expected\_gradient,\ optimized\_gradients[0])\ );}}
\DoxyCodeLine{00380\ \ \ \}}
\DoxyCodeLine{00381\ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_quadratic_test_parameters}{QuadraticTestParameters}}}
\DoxyCodeLine{00385\ \{}
\DoxyCodeLine{00386\ \ \ \textcolor{keywordtype}{size\_t}\ resolution\ =\ 3;}
\DoxyCodeLine{00387\ \ \ \textcolor{keywordtype}{double}\ u\_curvature\ =\ 0;}
\DoxyCodeLine{00388\ \ \ \textcolor{keywordtype}{double}\ v\_curvature\ =\ 0;}
\DoxyCodeLine{00389\ \ \ \textcolor{keywordtype}{double}\ uv\_curvature\ =\ 0;}
\DoxyCodeLine{00390\ \ \ \textcolor{keywordtype}{double}\ dx\ =\ 0;}
\DoxyCodeLine{00391\ \ \ \textcolor{keywordtype}{double}\ dy\ =\ 0;}
\DoxyCodeLine{00392\ \ \ \textcolor{keywordtype}{double}\ dz\ =\ 0;}
\DoxyCodeLine{00393\ \ \ \textcolor{keywordtype}{bool}\ tile\_perturbation\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00394\ \};}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \textcolor{keywordtype}{void}\ generate\_quadratic\_test(}
\DoxyCodeLine{00397\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_quadratic_test_parameters}{QuadraticTestParameters}}\ \&quadratic\_test\_params,}
\DoxyCodeLine{00398\ \ \ MatrixXr\ \&V,}
\DoxyCodeLine{00399\ \ \ std::vector<Matrix2x3r>\ \&gradients,}
\DoxyCodeLine{00400\ \ \ std::vector<int>\ \&variable\_vertices,}
\DoxyCodeLine{00401\ \ \ \mbox{\hyperlink{class_affine_manifold}{AffineManifold}}\ \&affine\_manifold}
\DoxyCodeLine{00402\ )\ \{}
\DoxyCodeLine{00403\ \ \ \textcolor{keywordtype}{size\_t}\ resolution\ =\ quadratic\_test\_params.resolution;}
\DoxyCodeLine{00404\ \ \ \textcolor{keywordtype}{double}\ u\_curvature\ =\ quadratic\_test\_params.u\_curvature;}
\DoxyCodeLine{00405\ \ \ \textcolor{keywordtype}{double}\ v\_curvature\ =\ quadratic\_test\_params.v\_curvature;}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordtype}{double}\ uv\_curvature\ =\ quadratic\_test\_params.uv\_curvature;}
\DoxyCodeLine{00407\ \ \ \textcolor{keywordtype}{double}\ dx\ =\ quadratic\_test\_params.dx;}
\DoxyCodeLine{00408\ \ \ \textcolor{keywordtype}{double}\ dy\ =\ quadratic\_test\_params.dy;}
\DoxyCodeLine{00409\ \ \ \textcolor{keywordtype}{double}\ dz\ =\ quadratic\_test\_params.dz;}
\DoxyCodeLine{00410\ \ \ \textcolor{keywordtype}{bool}\ tile\_perturbation\ =\ quadratic\_test\_params.tile\_perturbation;}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \ \ \textcolor{comment}{//\ Build\ uv\ layout\ }}
\DoxyCodeLine{00413\ \ \ std::vector<\ std::vector<PlanarPoint>\ >\ layout\_point\_grid;}
\DoxyCodeLine{00414\ \ \ generate\_global\_layout\_grid(resolution,\ layout\_point\_grid);}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \textcolor{keywordtype}{size\_t}\ perturbed\_index\ =\ (resolution\ /\ 2);}
\DoxyCodeLine{00417\ \ \ \textcolor{keywordtype}{size\_t}\ perturbed\_u\_index\ =\ perturbed\_index;}
\DoxyCodeLine{00418\ \ \ \textcolor{keywordtype}{size\_t}\ perturbed\_v\_index\ =\ perturbed\_index;}
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{if}\ (tile\_perturbation)}
\DoxyCodeLine{00420\ \ \ \{}
\DoxyCodeLine{00421\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ resolution;\ i\ +=\ 2)}
\DoxyCodeLine{00422\ \ \ \ \ \{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 1;\ j\ <\ resolution;\ j\ +=\ 2)}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00425\ \ \ \ \ \ \ spdlog::info(\textcolor{stringliteral}{"{}Perturbing\ index\ \{\},\ \{\}"{}},\ i,\ j);}
\DoxyCodeLine{00426\ \ \ \ \ \ \ layout\_point\_grid[i][j][0]\ +=\ dx;}
\DoxyCodeLine{00427\ \ \ \ \ \ \ layout\_point\_grid[i][j][1]\ +=\ dy;}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \ \ \}}
\DoxyCodeLine{00430\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00431\ \ \ \ \ spdlog::info(\textcolor{stringliteral}{"{}Perturbing\ index\ \{\},\ \{\}"{}},\ perturbed\_u\_index,\ perturbed\_v\_index);}
\DoxyCodeLine{00432\ \ \ \ \ layout\_point\_grid[perturbed\_u\_index][perturbed\_v\_index][0]\ +=\ dx;}
\DoxyCodeLine{00433\ \ \ \ \ layout\_point\_grid[perturbed\_u\_index][perturbed\_v\_index][1]\ +=\ dy;}
\DoxyCodeLine{00434\ \ \ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \textcolor{comment}{//\ Generate\ quadratic\ function\ grid\ points}}
\DoxyCodeLine{00437\ \ \ std::vector<\ std::vector<SpatialVector>\ >\ point\_grid;}
\DoxyCodeLine{00438\ \ \ generate\_quadratic\_grid(}
\DoxyCodeLine{00439\ \ \ \ \ layout\_point\_grid,}
\DoxyCodeLine{00440\ \ \ \ \ u\_curvature,}
\DoxyCodeLine{00441\ \ \ \ \ v\_curvature,}
\DoxyCodeLine{00442\ \ \ \ \ uv\_curvature,}
\DoxyCodeLine{00443\ \ \ \ \ point\_grid}
\DoxyCodeLine{00444\ \ \ );}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ \textcolor{comment}{//\ Build\ mesh\ from\ the\ grid\ points}}
\DoxyCodeLine{00447\ \ \ Eigen::MatrixXi\ F;}
\DoxyCodeLine{00448\ \ \ std::vector<std::vector<double>>\ l;}
\DoxyCodeLine{00449\ \ \ \textcolor{keywordtype}{bool}\ closed\_surface\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00450\ \ \ generate\_mesh\_from\_grid(}
\DoxyCodeLine{00451\ \ \ \ \ point\_grid,}
\DoxyCodeLine{00452\ \ \ \ \ layout\_point\_grid,}
\DoxyCodeLine{00453\ \ \ \ \ V,}
\DoxyCodeLine{00454\ \ \ \ \ F,}
\DoxyCodeLine{00455\ \ \ \ \ l,}
\DoxyCodeLine{00456\ \ \ \ \ closed\_surface}
\DoxyCodeLine{00457\ \ \ );}
\DoxyCodeLine{00458\ \ \ \textcolor{comment}{//\ FIXME\ V(perturbed\_u\_index,\ perturbed\_v\_index)\ -\/=\ quadratic\_test\_params.dz;}}
\DoxyCodeLine{00459\ \ \ spdlog::debug(\textcolor{stringliteral}{"{}Initial\ spatial\ points:\(\backslash\)n\{\}"{}},\ V);}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \textcolor{comment}{//\ Build\ an\ affine\ manifold\ with\ global\ layout}}
\DoxyCodeLine{00462\ \ \ MatrixXr\ uv;}
\DoxyCodeLine{00463\ \ \ Eigen::MatrixXi\ layout\_F;}
\DoxyCodeLine{00464\ \ \ std::vector<std::vector<double>>\ layout\_l;}
\DoxyCodeLine{00465\ \ \ generate\_mesh\_from\_grid(layout\_point\_grid,\ uv,\ layout\_F,\ layout\_l,\ closed\_surface);}
\DoxyCodeLine{00466\ \ \ affine\_manifold\ =\ \mbox{\hyperlink{class_parametric_affine_manifold}{ParametricAffineManifold}}(F,\ uv);}
\DoxyCodeLine{00467\ \ \ spdlog::debug(\textcolor{stringliteral}{"{}Global\ UV\ points:\(\backslash\)n\{\}"{}},\ uv);}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ \textcolor{comment}{//\ Generate\ gradients\ for\ the\ quadratic\ at\ the\ grid\ points}}
\DoxyCodeLine{00470\ \ \ std::vector<\ std::vector<Matrix2x3r>\ >\ gradient\_grid;}
\DoxyCodeLine{00471\ \ \ generate\_quadratic\_gradients\_grid(}
\DoxyCodeLine{00472\ \ \ \ \ layout\_point\_grid,}
\DoxyCodeLine{00473\ \ \ \ \ u\_curvature,}
\DoxyCodeLine{00474\ \ \ \ \ v\_curvature,}
\DoxyCodeLine{00475\ \ \ \ \ uv\_curvature,}
\DoxyCodeLine{00476\ \ \ \ \ gradient\_grid}
\DoxyCodeLine{00477\ \ \ );}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ \textcolor{comment}{//\ Generate\ gradients\ and\ fixed\ degrees\ of\ freedom\ from\ the\ grid}}
\DoxyCodeLine{00480\ \ \ generate\_gradients\_from\_grid(gradient\_grid,\ gradients,\ variable\_vertices);}
\DoxyCodeLine{00481\ \}}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \textcolor{comment}{//double\ compute\_quadratic\_test\_energy(}}
\DoxyCodeLine{00484\ \textcolor{comment}{//\ \ const\ QuadraticTestParameters\ \&quadratic\_test\_params,}}
\DoxyCodeLine{00485\ \textcolor{comment}{//\ \ bool\ optimize\ =\ false}}
\DoxyCodeLine{00486\ \textcolor{comment}{//)\ \{}}
\DoxyCodeLine{00487\ \textcolor{comment}{//\ \ MatrixXr\ V;}}
\DoxyCodeLine{00488\ \textcolor{comment}{//\ \ std::vector<Matrix2x3r>\ gradients;}}
\DoxyCodeLine{00489\ \textcolor{comment}{//\ \ std::vector<int>\ variable\_vertices;}}
\DoxyCodeLine{00490\ \textcolor{comment}{//\ \ AffineManifold\ affine\_manifold;}}
\DoxyCodeLine{00491\ \textcolor{comment}{//\ \ generate\_quadratic\_test(}}
\DoxyCodeLine{00492\ \textcolor{comment}{//\ \ \ \ quadratic\_test\_params,}}
\DoxyCodeLine{00493\ \textcolor{comment}{//\ \ \ \ V,}}
\DoxyCodeLine{00494\ \textcolor{comment}{//\ \ \ \ gradients,}}
\DoxyCodeLine{00495\ \textcolor{comment}{//\ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00496\ \textcolor{comment}{//\ \ \ \ affine\_manifold}}
\DoxyCodeLine{00497\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00498\ \textcolor{comment}{//}}
\DoxyCodeLine{00499\ \textcolor{comment}{//\ \ //\ Set\ the\ optimization\ parameters}}
\DoxyCodeLine{00500\ \textcolor{comment}{//\ \ OptimizationParameters\ optimization\_params;}}
\DoxyCodeLine{00501\ \textcolor{comment}{//\ \ optimization\_params.parametrized\_quadratic\_surface\_mapping\_factor\ =\ 1.0;}}
\DoxyCodeLine{00502\ \textcolor{comment}{//\ \ optimization\_params.position\_difference\_factor\ =\ 1.0;}}
\DoxyCodeLine{00503\ \textcolor{comment}{//}}
\DoxyCodeLine{00504\ \textcolor{comment}{//\ \ //\ Optimize\ the\ analytic\ initial\ values}}
\DoxyCodeLine{00505\ \textcolor{comment}{//\ \ MatrixXr\ optimized\_V;}}
\DoxyCodeLine{00506\ \textcolor{comment}{//\ \ std::vector<Matrix2x3r>\ optimized\_gradients;}}
\DoxyCodeLine{00507\ \textcolor{comment}{//\ \ double\ energy\ =\ optimize\_six\_split\_spline\_surface(}}
\DoxyCodeLine{00508\ \textcolor{comment}{//\ \ \ \ V,}}
\DoxyCodeLine{00509\ \textcolor{comment}{//\ \ \ \ gradients,}}
\DoxyCodeLine{00510\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00511\ \textcolor{comment}{//\ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00512\ \textcolor{comment}{//\ \ \ \ optimization\_params,}}
\DoxyCodeLine{00513\ \textcolor{comment}{//\ \ \ \ optimized\_V,}}
\DoxyCodeLine{00514\ \textcolor{comment}{//\ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00515\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00516\ \textcolor{comment}{//}}
\DoxyCodeLine{00517\ \textcolor{comment}{//\ \ return\ energy;}}
\DoxyCodeLine{00518\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \textcolor{keywordtype}{bool}\ quadratic\_refinement\_test(}
\DoxyCodeLine{00521\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_quadratic_test_parameters}{QuadraticTestParameters}}\ \&quadratic\_test\_params}
\DoxyCodeLine{00522\ )\ \{}
\DoxyCodeLine{00523\ \ \ spdlog::set\_level(spdlog::level::info);}
\DoxyCodeLine{00524\ \ \ spdlog::info(\textcolor{stringliteral}{"{}Testing\ quadratic\ refinement"{}});}
\DoxyCodeLine{00525\ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \textcolor{comment}{//\ Build\ test\ parameters\ for\ the\ quadratic\ refinement}}
\DoxyCodeLine{00528\ \ \ \mbox{\hyperlink{struct_quadratic_test_parameters}{QuadraticTestParameters}}\ quadratic\_refinement\_test\_params;}
\DoxyCodeLine{00529\ \ \ quadratic\_refinement\_test\_params\ =\ quadratic\_test\_params;}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \textcolor{comment}{//\ Scale\ proportionally\ to\ the\ resolution}}
\DoxyCodeLine{00532\ \ \ \textcolor{keywordtype}{int}\ resolution\ =\ quadratic\_refinement\_test\_params.resolution;}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordtype}{double}\ k2\ =\ (resolution\ -\/\ 1);}
\DoxyCodeLine{00534\ \ \ quadratic\_refinement\_test\_params.u\_curvature\ /=\ k2;}
\DoxyCodeLine{00535\ \ \ quadratic\_refinement\_test\_params.v\_curvature\ /=\ k2;}
\DoxyCodeLine{00536\ \ \ quadratic\_refinement\_test\_params.uv\_curvature\ /=\ k2;}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \ \ \textcolor{comment}{//\ Compute\ the\ energy}}
\DoxyCodeLine{00539\ \ \ \textcolor{comment}{//double\ energy\ =\ compute\_quadratic\_test\_energy(quadratic\_refinement\_test\_params,\ true);}}
\DoxyCodeLine{00541\ \textcolor{comment}{}}
\DoxyCodeLine{00542\ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{00543\ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \textcolor{comment}{//void\ test()}}
\DoxyCodeLine{00548\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00549\ \textcolor{comment}{//\ \ std::vector<std::vector<int>>\ face\_to\_patch\_indices;}}
\DoxyCodeLine{00550\ \textcolor{comment}{//\ \ std::vector<int>\ patch\_to\_face\_indices;}}
\DoxyCodeLine{00551\ \textcolor{comment}{//\ \ QuadraticSplineSurface\ initial\_spline\_surface(}}
\DoxyCodeLine{00552\ \textcolor{comment}{//\ \ \ \ initial\_V,}}
\DoxyCodeLine{00553\ \textcolor{comment}{//\ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00554\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00555\ \textcolor{comment}{//\ \ \ \ face\_to\_patch\_indices,}}
\DoxyCodeLine{00556\ \textcolor{comment}{//\ \ \ \ patch\_to\_face\_indices}}
\DoxyCodeLine{00557\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00558\ \textcolor{comment}{//\ \ //initial\_spline\_surface.view();}}
\DoxyCodeLine{00559\ \textcolor{comment}{//\ \ double\ pert\ =\ 1e-\/6;}}
\DoxyCodeLine{00560\ \textcolor{comment}{//\ \ MatrixXr\ V\_pert(10,\ 3);}}
\DoxyCodeLine{00561\ \textcolor{comment}{//\ \ V\_pert.setZero(10,\ 3);}}
\DoxyCodeLine{00562\ \textcolor{comment}{//\ \ V\_pert(0,\ 0)\ =\ pert;}}
\DoxyCodeLine{00563\ \textcolor{comment}{//\ \ V\_pert(1,\ 1)\ =\ pert;}}
\DoxyCodeLine{00564\ \textcolor{comment}{//\ \ V\_pert(2,\ 2)\ =\ pert;}}
\DoxyCodeLine{00565\ \textcolor{comment}{//\ \ MatrixXr\ gradients\_pert(20,\ 3);}}
\DoxyCodeLine{00566\ \textcolor{comment}{//\ \ gradients\_pert.setZero(20,\ 3);}}
\DoxyCodeLine{00567\ \textcolor{comment}{//\ \ gradients\_pert(6,\ 0)\ =\ pert;}}
\DoxyCodeLine{00568\ \textcolor{comment}{//\ \ gradients\_pert(8,\ 1)\ =\ pert;}}
\DoxyCodeLine{00569\ \textcolor{comment}{//\ \ gradients\_pert(10,\ 2)\ =\ pert;}}
\DoxyCodeLine{00570\ \textcolor{comment}{//\ \ gradients\_pert(13,\ 0)\ =\ pert;}}
\DoxyCodeLine{00571\ \textcolor{comment}{//\ \ gradients\_pert(15,\ 1)\ =\ pert;}}
\DoxyCodeLine{00572\ \textcolor{comment}{//\ \ gradients\_pert(17,\ 2)\ =\ pert;}}
\DoxyCodeLine{00573\ \textcolor{comment}{//\ \ MatrixXr\ analytic\_hessian;}}
\DoxyCodeLine{00574\ \textcolor{comment}{//\ \ VectorXr\ analytic\_derivatives;}}
\DoxyCodeLine{00575\ \textcolor{comment}{//\ \ double\ analytic\_energy;}}
\DoxyCodeLine{00576\ \textcolor{comment}{//\ \ for\ (size\_t\ i\ =\ 9;\ i\ <\ 10;\ ++i)}}
\DoxyCodeLine{00577\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{00578\ \textcolor{comment}{//\ \ \ \ spdlog::info("{}Perturbation\ \{\}\ with\(\backslash\)n\{\}\(\backslash\)nand\(\backslash\)n\{\}"{},\ i,\ V\_pert.row(i),\ gradients\_pert.block(2\ *\ i,\ 0,\ 2,\ 3));}}
\DoxyCodeLine{00579\ \textcolor{comment}{//\ \ \ \ MatrixXr\ initial\_V\_pert\ =\ initial\_V;}}
\DoxyCodeLine{00580\ \textcolor{comment}{//\ \ \ \ initial\_V\_pert.row(4)\ +=\ V\_pert.row(i);}}
\DoxyCodeLine{00581\ \textcolor{comment}{//\ \ \ \ std::vector<MatrixXr>\ initial\_gradients\_pert\ =\ initial\_gradients;}}
\DoxyCodeLine{00582\ \textcolor{comment}{//\ \ \ \ initial\_gradients\_pert[4]\ +=\ gradients\_pert.block(2\ *\ i,\ 0,\ 2,\ 3)\ ;}}
\DoxyCodeLine{00583\ \textcolor{comment}{//\ \ \ \ initialize\_six\_split\_variables(}}
\DoxyCodeLine{00584\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V\_pert,}}
\DoxyCodeLine{00585\ \textcolor{comment}{//\ \ \ \ \ \ initial\_gradients\_pert,}}
\DoxyCodeLine{00586\ \textcolor{comment}{//\ \ \ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00587\ \textcolor{comment}{//\ \ \ \ \ \ positions,}}
\DoxyCodeLine{00588\ \textcolor{comment}{//\ \ \ \ \ \ gradients,}}
\DoxyCodeLine{00589\ \textcolor{comment}{//\ \ \ \ \ \ false}}
\DoxyCodeLine{00590\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00591\ \textcolor{comment}{//\ \ \ \ generate\_six\_split\_energy\_quadratic(}}
\DoxyCodeLine{00592\ \textcolor{comment}{//\ \ \ \ \ \ positions,}}
\DoxyCodeLine{00593\ \textcolor{comment}{//\ \ \ \ \ \ gradients,}}
\DoxyCodeLine{00594\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00595\ \textcolor{comment}{//\ \ \ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00596\ \textcolor{comment}{//\ \ \ \ \ \ triangle\_energy,}}
\DoxyCodeLine{00597\ \textcolor{comment}{//\ \ \ \ \ \ analytic\_hessian,}}
\DoxyCodeLine{00598\ \textcolor{comment}{//\ \ \ \ \ \ analytic\_derivatives,}}
\DoxyCodeLine{00599\ \textcolor{comment}{//\ \ \ \ \ \ analytic\_energy}}
\DoxyCodeLine{00600\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00601\ \textcolor{comment}{//\ \ \ \ assert(\ matrix\_equal(analytic\_hessian,\ hessian)\ );}}
\DoxyCodeLine{00602\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00603\ \textcolor{comment}{//\ \ spdlog::info("{}Initial\ variable\ values:\ \{\}"{},\ initial\_variable\_values);}}
\DoxyCodeLine{00604\ \textcolor{comment}{//\ \ spdlog::info("{}Analytic\ variable\ values:\ \{\}"{},\ variable\_values);}}
\DoxyCodeLine{00605\ \textcolor{comment}{//}}
\DoxyCodeLine{00606\ \textcolor{comment}{//\ \ optimized\_V\ =\ initial\_V;}}
\DoxyCodeLine{00607\ \textcolor{comment}{//\ \ optimized\_gradients\ =\ initial\_gradients;}}
\DoxyCodeLine{00608\ \textcolor{comment}{//\ \ spdlog::info("{}z\ coord\ derivative\ \{\}"{},\ analytic\_derivatives[2]);}}
\DoxyCodeLine{00609\ \textcolor{comment}{//\ \ optimized\_V(4,\ 2)\ -\/=\ 10\ *\ analytic\_derivatives[2];}}
\DoxyCodeLine{00610\ \textcolor{comment}{//\ \ initialize\_six\_split\_variables(}}
\DoxyCodeLine{00611\ \textcolor{comment}{//\ \ \ \ optimized\_V,}}
\DoxyCodeLine{00612\ \textcolor{comment}{//\ \ \ \ optimized\_gradients,}}
\DoxyCodeLine{00613\ \textcolor{comment}{//\ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00614\ \textcolor{comment}{//\ \ \ \ positions,}}
\DoxyCodeLine{00615\ \textcolor{comment}{//\ \ \ \ gradients,}}
\DoxyCodeLine{00616\ \textcolor{comment}{//\ \ \ \ false}}
\DoxyCodeLine{00617\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00618\ \textcolor{comment}{//\ \ generate\_six\_split\_energy\_quadratic(}}
\DoxyCodeLine{00619\ \textcolor{comment}{//\ \ \ \ positions,}}
\DoxyCodeLine{00620\ \textcolor{comment}{//\ \ \ \ gradients,}}
\DoxyCodeLine{00621\ \textcolor{comment}{//\ \ \ \ initial\_V,}}
\DoxyCodeLine{00622\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00623\ \textcolor{comment}{//\ \ \ \ triangle\_energy,}}
\DoxyCodeLine{00624\ \textcolor{comment}{//\ \ \ \ hessian,}}
\DoxyCodeLine{00625\ \textcolor{comment}{//\ \ \ \ derivatives,}}
\DoxyCodeLine{00626\ \textcolor{comment}{//\ \ \ \ energy}}
\DoxyCodeLine{00627\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00628\ \textcolor{comment}{//\ \ QuadraticSplineSurface\ first\_optimized\_spline\_surface(}}
\DoxyCodeLine{00629\ \textcolor{comment}{//\ \ \ \ optimized\_V,}}
\DoxyCodeLine{00630\ \textcolor{comment}{//\ \ \ \ optimized\_gradients,}}
\DoxyCodeLine{00631\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00632\ \textcolor{comment}{//\ \ \ \ face\_to\_patch\_indices,}}
\DoxyCodeLine{00633\ \textcolor{comment}{//\ \ \ \ patch\_to\_face\_indices}}
\DoxyCodeLine{00634\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00635\ \textcolor{comment}{//\ \ first\_optimized\_spline\_surface.view();}}
\DoxyCodeLine{00636\ \textcolor{comment}{//}}
\DoxyCodeLine{00637\ \textcolor{comment}{//\ \ if\ (\ !float\_equal(residual.norm(),\ 0.0)\ )\ return\ false;}}
\DoxyCodeLine{00638\ \textcolor{comment}{//\ \ return\ true;}}
\DoxyCodeLine{00639\ \textcolor{comment}{//}}
\DoxyCodeLine{00640\ \textcolor{comment}{//}}
\DoxyCodeLine{00641\ \textcolor{comment}{//\ \ spdlog::debug("{}Optimized\ energy:\ \{\}"{},\ energy);}}
\DoxyCodeLine{00642\ \textcolor{comment}{//\ \ spdlog::debug("{}Optimized\ positions:\(\backslash\)n\{\}"{},\ optimized\_V);}}
\DoxyCodeLine{00643\ \textcolor{comment}{//\ \ spdlog::debug("{}Optimized\ gradients:\(\backslash\)n\{\}"{},\ formatted\_vector(optimized\_gradients));}}
\DoxyCodeLine{00644\ \textcolor{comment}{//\ \ QuadraticSplineSurface\ second\_optimized\_spline\_surface(}}
\DoxyCodeLine{00645\ \textcolor{comment}{//\ \ \ \ optimized\_V,}}
\DoxyCodeLine{00646\ \textcolor{comment}{//\ \ \ \ optimized\_gradients,}}
\DoxyCodeLine{00647\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00648\ \textcolor{comment}{//\ \ \ \ face\_to\_patch\_indices,}}
\DoxyCodeLine{00649\ \textcolor{comment}{//\ \ \ \ patch\_to\_face\_indices}}
\DoxyCodeLine{00650\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00651\ \textcolor{comment}{//\ \ first\_optimized\_spline\_surface.view();}}
\DoxyCodeLine{00652\ \textcolor{comment}{//}}
\DoxyCodeLine{00653\ \textcolor{comment}{//\ \ //\ Check\ for\ errors\ }}
\DoxyCodeLine{00654\ \textcolor{comment}{//\ \ bool\ success\ =\ true;}}
\DoxyCodeLine{00655\ \textcolor{comment}{//\ \ for\ (size\_t\ i\ =\ 0;\ i\ <\ optimized\_gradients.size();\ ++i)}}
\DoxyCodeLine{00656\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{00657\ \textcolor{comment}{//\ \ \ \ if(\ !matrix\_equal(\ analytic\_gradients[i],\ optimized\_gradients[i]\ )\ )}}
\DoxyCodeLine{00658\ \textcolor{comment}{//\ \ \ \ \{}}
\DoxyCodeLine{00659\ \textcolor{comment}{//\ \ \ \ \ \ spdlog::error(}}
\DoxyCodeLine{00660\ \textcolor{comment}{//\ \ \ \ \ \ \ \ "{}Optimized\ gradient\(\backslash\)n\{\}\(\backslash\)nnot\ equal\ to\ expected\ value\(\backslash\)n\{\}"{},}}
\DoxyCodeLine{00661\ \textcolor{comment}{//\ \ \ \ \ \ \ \ optimized\_gradients[i],}}
\DoxyCodeLine{00662\ \textcolor{comment}{//\ \ \ \ \ \ \ \ analytic\_gradients[i]}}
\DoxyCodeLine{00663\ \textcolor{comment}{//\ \ \ \ \ \ );}}
\DoxyCodeLine{00664\ \textcolor{comment}{//\ \ \ \ \ \ spdlog::error(}}
\DoxyCodeLine{00665\ \textcolor{comment}{//\ \ \ \ \ \ \ \ "{}Corresponding\ optimized\ vertex\ is\ \(\backslash\)n\{\}\(\backslash\)nwith\ expected\ value\{\}"{},}}
\DoxyCodeLine{00666\ \textcolor{comment}{//\ \ \ \ \ \ \ \ optimized\_V.row(i),}}
\DoxyCodeLine{00667\ \textcolor{comment}{//\ \ \ \ \ \ \ \ initial\_V.row(i)}}
\DoxyCodeLine{00668\ \textcolor{comment}{//\ \ \ \ \ \ );}}
\DoxyCodeLine{00669\ \textcolor{comment}{//\ \ \ \ \ \ success\ =\ false;}}
\DoxyCodeLine{00670\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00671\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00672\ \textcolor{comment}{//\ \ //\ Get\ initial\ residual}}
\DoxyCodeLine{00673\ \textcolor{comment}{//\ \ generate\_six\_split\_variable\_value\_vector(}}
\DoxyCodeLine{00674\ \textcolor{comment}{//\ \ \ \ positions,}}
\DoxyCodeLine{00675\ \textcolor{comment}{//\ \ \ \ gradients,}}
\DoxyCodeLine{00676\ \textcolor{comment}{//\ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00677\ \textcolor{comment}{//\ \ \ \ variable\_values}}
\DoxyCodeLine{00678\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00679\ \textcolor{comment}{//\ \ compute\_quadratic\_residual(}}
\DoxyCodeLine{00680\ \textcolor{comment}{//\ \ \ \ variable\_values,}}
\DoxyCodeLine{00681\ \textcolor{comment}{//\ \ \ \ derivatives,}}
\DoxyCodeLine{00682\ \textcolor{comment}{//\ \ \ \ hessian,}}
\DoxyCodeLine{00683\ \textcolor{comment}{//\ \ \ \ residual}}
\DoxyCodeLine{00684\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00685\ \textcolor{comment}{//\ \ spdlog::info("{}Initial\ residual:\ \{\}"{},\ residual);}}
\DoxyCodeLine{00686\ \textcolor{comment}{//\ \ if\ (!success)\ return\ false;}}
\DoxyCodeLine{00687\ \textcolor{comment}{//\ \ return\ true;}}
\DoxyCodeLine{00688\ \textcolor{comment}{//}}
\DoxyCodeLine{00689\ \textcolor{comment}{//\ \ spdlog::info("{}Testing\ with\ one\ gradient\ set\ to\ 0"{});}}
\DoxyCodeLine{00690\ \textcolor{comment}{//\ \ initial\_gradients[resolution\ +\ 1]\ <<}}
\DoxyCodeLine{00691\ \textcolor{comment}{//\ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00692\ \textcolor{comment}{//\ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00693\ \textcolor{comment}{//\ \ energy\ =\ optimize\_six\_split\_spline\_surface(}}
\DoxyCodeLine{00694\ \textcolor{comment}{//\ \ \ \ initial\_V,}}
\DoxyCodeLine{00695\ \textcolor{comment}{//\ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00696\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00697\ \textcolor{comment}{//\ \ \ \ variable\_vertices,}}
\DoxyCodeLine{00698\ \textcolor{comment}{//\ \ \ \ optimization\_params,}}
\DoxyCodeLine{00699\ \textcolor{comment}{//\ \ \ \ optimized\_V,}}
\DoxyCodeLine{00700\ \textcolor{comment}{//\ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00701\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00702\ \textcolor{comment}{//}}
\DoxyCodeLine{00703\ \textcolor{comment}{//\ \ QuadraticSplineSurface\ optimized\_spline\_surface(}}
\DoxyCodeLine{00704\ \textcolor{comment}{//\ \ \ \ optimized\_V,}}
\DoxyCodeLine{00705\ \textcolor{comment}{//\ \ \ \ optimized\_gradients,}}
\DoxyCodeLine{00706\ \textcolor{comment}{//\ \ \ \ affine\_manifold,}}
\DoxyCodeLine{00707\ \textcolor{comment}{//\ \ \ \ face\_to\_patch\_indices,}}
\DoxyCodeLine{00708\ \textcolor{comment}{//\ \ \ \ patch\_to\_face\_indices}}
\DoxyCodeLine{00709\ \textcolor{comment}{//\ \ );}}
\DoxyCodeLine{00710\ \textcolor{comment}{//\ \ optimized\_spline\_surface.view();}}
\DoxyCodeLine{00711\ \textcolor{comment}{//}}
\DoxyCodeLine{00712\ \textcolor{comment}{//\ \ spdlog::debug("{}Perturbed\ start\ energy:\ \{\}"{},\ energy);}}
\DoxyCodeLine{00713\ \textcolor{comment}{//\ \ spdlog::debug("{}Optimized\ positions:\(\backslash\)n\{\}"{},\ optimized\_V);}}
\DoxyCodeLine{00714\ \textcolor{comment}{//\ \ spdlog::debug("{}Optimized\ gradients:\(\backslash\)n\{\}"{},\ formatted\_vector(optimized\_gradients));}}
\DoxyCodeLine{00715\ \textcolor{comment}{//}}
\DoxyCodeLine{00716\ \textcolor{comment}{//\ \ for\ (size\_t\ i\ =\ 0;\ i\ <\ optimized\_gradients.size();\ ++i)}}
\DoxyCodeLine{00717\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{00718\ \textcolor{comment}{//\ \ \ \ if(\ !matrix\_equal(\ analytic\_gradients[i],\ optimized\_gradients[i]\ )\ )\ return\ false;}}
\DoxyCodeLine{00719\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00720\ \textcolor{comment}{//}}
\DoxyCodeLine{00721\ \textcolor{comment}{//\ \ return\ true;}}
\DoxyCodeLine{00722\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ TEST\_CASE\ (\ \textcolor{stringliteral}{"{}Quadratic\ affine\ manifold\ energy\ can\ be\ computed"{}},\ \textcolor{stringliteral}{"{}[optimize\_spline\_surface]"{}})}
\DoxyCodeLine{00725\ \{}
\DoxyCodeLine{00726\ \ \ MatrixXr\ initial\_V;}
\DoxyCodeLine{00727\ \ \ std::vector<Matrix2x3r>\ initial\_gradients;}
\DoxyCodeLine{00728\ \ \ MatrixXr\ optimized\_V;}
\DoxyCodeLine{00729\ \ \ std::vector<Matrix2x3r>\ optimized\_gradients;}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ SECTION\ (\ \textcolor{stringliteral}{"{}Small\ planar"{}}\ )}
\DoxyCodeLine{00732\ \ \ \{}
\DoxyCodeLine{00733\ \ \ \ \ \mbox{\hyperlink{struct_quadratic_test_parameters}{QuadraticTestParameters}}\ quadratic\_test\_params;}
\DoxyCodeLine{00734\ \ \ \ \ \textcolor{comment}{//bool\ success\ =\ quadratic\_residual\_test(quadratic\_test\_params);}}
\DoxyCodeLine{00735\ \ \ \ \ \textcolor{comment}{//REQUIRE\ (\ success\ );}}
\DoxyCodeLine{00736\ \ \ \}}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \textcolor{comment}{//\ \ SECTION\ (\ "{}Large\ planar"{}\ )}}
\DoxyCodeLine{00739\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{00740\ \textcolor{comment}{//\ \ \ \ size\_t\ resolution\ =\ 4;}}
\DoxyCodeLine{00741\ \textcolor{comment}{//\ \ \ \ double\ u\_curvature\ =\ 0;}}
\DoxyCodeLine{00742\ \textcolor{comment}{//\ \ \ \ double\ v\_curvature\ =\ 0;}}
\DoxyCodeLine{00743\ \textcolor{comment}{//\ \ \ \ bool\ success\ =\ quadratic\_surface\_test(}}
\DoxyCodeLine{00744\ \textcolor{comment}{//\ \ \ \ \ \ resolution,}}
\DoxyCodeLine{00745\ \textcolor{comment}{//\ \ \ \ \ \ u\_curvature,}}
\DoxyCodeLine{00746\ \textcolor{comment}{//\ \ \ \ \ \ v\_curvature,}}
\DoxyCodeLine{00747\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00748\ \textcolor{comment}{//\ \ \ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00749\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_V,}}
\DoxyCodeLine{00750\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00751\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00752\ \textcolor{comment}{//}}
\DoxyCodeLine{00753\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ success\ );}}
\DoxyCodeLine{00754\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \ \ SECTION\ (\ \textcolor{stringliteral}{"{}Small\ quadratic"{}}\ )}
\DoxyCodeLine{00757\ \ \ \{}
\DoxyCodeLine{00758\ \ \ \ \ \mbox{\hyperlink{struct_quadratic_test_parameters}{QuadraticTestParameters}}\ quadratic\_test\_params;}
\DoxyCodeLine{00759\ \ \ \ \ quadratic\_test\_params.u\_curvature\ =\ 2;}
\DoxyCodeLine{00760\ \ \ \ \ quadratic\_test\_params.dx\ =\ 0.1;}
\DoxyCodeLine{00761\ \ \ \ \ quadratic\_test\_params.tile\_perturbation\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00762\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{keywordtype}{bool}\ test\_success;}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{comment}{//test\_success\ =\ quadratic\_residual\_test(quadratic\_test\_params);}}
\DoxyCodeLine{00765\ \ \ \ \ success\ =\ success\ \&\&\ test\_success;}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ \ \ test\_success\ =\ quadratic\_refinement\_test(quadratic\_test\_params);}
\DoxyCodeLine{00768\ \ \ \ \ success\ =\ success\ \&\&\ test\_success;}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \ \ \textcolor{comment}{//quadratic\_test\_params.resolution\ =\ 5;}}
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{comment}{//test\_success\ =\ quadratic\_refinement\_test(quadratic\_test\_params);}}
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{comment}{//success\ =\ success\ \&\&\ test\_success;}}
\DoxyCodeLine{00773\ \ \ \ \ }
\DoxyCodeLine{00774\ \ \ \ \ \textcolor{comment}{//quadratic\_test\_params.resolution\ =\ 7;}}
\DoxyCodeLine{00775\ \ \ \ \ \textcolor{comment}{//test\_success\ =\ quadratic\_refinement\_test(quadratic\_test\_params);}}
\DoxyCodeLine{00776\ \ \ \ \ \textcolor{comment}{//success\ =\ success\ \&\&\ test\_success;}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \ \ \textcolor{comment}{//quadratic\_test\_params.resolution\ =\ 9;}}
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{comment}{//test\_success\ =\ quadratic\_refinement\_test(quadratic\_test\_params);}}
\DoxyCodeLine{00780\ \ \ \ \ \textcolor{comment}{//success\ =\ success\ \&\&\ test\_success;}}
\DoxyCodeLine{00781\ \ \ \ \ \textcolor{comment}{//REQUIRE\ (\ success\ );}}
\DoxyCodeLine{00782\ \ \ \}}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \textcolor{comment}{//\ \ SECTION\ (\ "{}Large\ quadratic"{}\ )}}
\DoxyCodeLine{00785\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{00786\ \textcolor{comment}{//\ \ \ \ size\_t\ resolution\ =\ 4;}}
\DoxyCodeLine{00787\ \textcolor{comment}{//\ \ \ \ double\ u\_curvature\ =\ 0;}}
\DoxyCodeLine{00788\ \textcolor{comment}{//\ \ \ \ double\ v\_curvature\ =\ 1;}}
\DoxyCodeLine{00789\ \textcolor{comment}{//\ \ \ \ bool\ success\ =\ quadratic\_surface\_test(}}
\DoxyCodeLine{00790\ \textcolor{comment}{//\ \ \ \ \ \ resolution,}}
\DoxyCodeLine{00791\ \textcolor{comment}{//\ \ \ \ \ \ u\_curvature,}}
\DoxyCodeLine{00792\ \textcolor{comment}{//\ \ \ \ \ \ v\_curvature,}}
\DoxyCodeLine{00793\ \textcolor{comment}{//\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00794\ \textcolor{comment}{//\ \ \ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00795\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_V,}}
\DoxyCodeLine{00796\ \textcolor{comment}{//\ \ \ \ \ \ optimized\_gradients}}
\DoxyCodeLine{00797\ \textcolor{comment}{//\ \ \ \ );}}
\DoxyCodeLine{00798\ \textcolor{comment}{//}}
\DoxyCodeLine{00799\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ success\ );}}
\DoxyCodeLine{00800\ \textcolor{comment}{//}}
\DoxyCodeLine{00801\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00802\ \}}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \textcolor{comment}{/*}}
\DoxyCodeLine{00805\ \textcolor{comment}{TEST\_CASE\ (\ "{}Triangle\ quadratic\ surface\ mapping\ energy\ can\ be\ computed"{},\ "{}[optimize\_spline\_surface]"{})}}
\DoxyCodeLine{00806\ \textcolor{comment}{\{}}
\DoxyCodeLine{00807\ \textcolor{comment}{\ \ MatrixXr\ P(3,\ 3);}}
\DoxyCodeLine{00808\ \textcolor{comment}{\ \ MatrixXr\ G(6,\ 3);}}
\DoxyCodeLine{00809\ \textcolor{comment}{\ \ DynamicVectorXv\ pi,\ pj,\ pk;}}
\DoxyCodeLine{00810\ \textcolor{comment}{\ \ DynamicMatrixXv\ Gi,\ Gj,\ Gk;}}
\DoxyCodeLine{00811\ \textcolor{comment}{\ \ MatrixXr\ real\_Gi,\ real\_Gj,\ real\_Gk;}}
\DoxyCodeLine{00812\ \textcolor{comment}{\ \ VectorXr\ gradient;}}
\DoxyCodeLine{00813\ \textcolor{comment}{\ \ MatrixXr\ hessian;}}
\DoxyCodeLine{00814\ \textcolor{comment}{}}
\DoxyCodeLine{00815\ \textcolor{comment}{\ \ SECTION\ (\ "{}Planar\ triangle"{}\ )}}
\DoxyCodeLine{00816\ \textcolor{comment}{\ \ \{}}
\DoxyCodeLine{00817\ \textcolor{comment}{\ \ \ \ //\ Setup\ planar\ triangle}}
\DoxyCodeLine{00818\ \textcolor{comment}{\ \ \ \ P\ <<\ }}
\DoxyCodeLine{00819\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00820\ \textcolor{comment}{\ \ \ \ \ \ 1,\ 0,\ 0,}}
\DoxyCodeLine{00821\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 1,\ 0;}}
\DoxyCodeLine{00822\ \textcolor{comment}{\ \ \ \ G\ <<}}
\DoxyCodeLine{00823\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00824\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00825\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00826\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00827\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{00828\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{00829\ \textcolor{comment}{\ \ \ \ MatrixXr\ Ui(2,2);}}
\DoxyCodeLine{00830\ \textcolor{comment}{\ \ \ \ MatrixXr\ Uj(2,2);}}
\DoxyCodeLine{00831\ \textcolor{comment}{\ \ \ \ MatrixXr\ Uk(2,2);}}
\DoxyCodeLine{00832\ \textcolor{comment}{\ \ \ \ Ui\ <<}}
\DoxyCodeLine{00833\ \textcolor{comment}{\ \ \ \ \ \ 1,\ 0,}}
\DoxyCodeLine{00834\ \textcolor{comment}{\ \ \ \ \ \ 0,\ 1;}}
\DoxyCodeLine{00835\ \textcolor{comment}{\ \ \ \ Uj\ <<}}
\DoxyCodeLine{00836\ \textcolor{comment}{\ \ \ \ \ \ -\/1,\ 1,}}
\DoxyCodeLine{00837\ \textcolor{comment}{\ \ \ \ \ \ -\/1,\ 0;}}
\DoxyCodeLine{00838\ \textcolor{comment}{\ \ \ \ Uk\ <<}}
\DoxyCodeLine{00839\ \textcolor{comment}{\ \ \ \ \ \ 0,\ -\/1,}}
\DoxyCodeLine{00840\ \textcolor{comment}{\ \ \ \ \ \ 1,\ -\/1;}}
\DoxyCodeLine{00841\ \textcolor{comment}{}}
\DoxyCodeLine{00842\ \textcolor{comment}{\ \ \ \ //\ Build\ independent\ variables\ for\ the\ triangle}}
\DoxyCodeLine{00843\ \textcolor{comment}{\ \ \ \ build\_triangle\_variables(P,\ G,\ pi,\ pj,\ pk,\ Gi,\ Gj,\ Gk);}}
\DoxyCodeLine{00844\ \textcolor{comment}{}}
\DoxyCodeLine{00845\ \textcolor{comment}{\ \ \ \ //\ Compute\ initial\ differentiable\ energy\ }}
\DoxyCodeLine{00846\ \textcolor{comment}{\ \ \ \ TriangleEnergy\ triangle\_energy;}}
\DoxyCodeLine{00847\ \textcolor{comment}{\ \ \ \ DynamicVar\ energy\ =\ triangle\_energy.triangle\_quadratic\_surface\_mapping\_energy(pi,\ pj,\ pk,\ Gi,\ Gj,\ Gk,\ Ui,\ Uj,\ Uk);}}
\DoxyCodeLine{00848\ \textcolor{comment}{\ \ \ \ double\ energy\_value\ =\ compute\_variable\_value(energy);}}
\DoxyCodeLine{00849\ \textcolor{comment}{\ \ \ \ compute\_variable\_gradient(energy,\ gradient);}}
\DoxyCodeLine{00850\ \textcolor{comment}{\ \ \ \ compute\_variable\_hessian(energy,\ hessian);}}
\DoxyCodeLine{00851\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}Energy:\ \{\}"{},\ energy\_value);}}
\DoxyCodeLine{00852\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}Gradient:\(\backslash\)n\{\}"{},\ gradient);}}
\DoxyCodeLine{00853\ \textcolor{comment}{}}
\DoxyCodeLine{00854\ \textcolor{comment}{\ \ \ \ //\ Get\ Newton\ direction\ for\ fixed\ positions}}
\DoxyCodeLine{00855\ \textcolor{comment}{\ \ \ \ VectorXr\ newton\_direction;}}
\DoxyCodeLine{00856\ \textcolor{comment}{\ \ \ \ compute\_fixed\_position\_newton\_direction(}}
\DoxyCodeLine{00857\ \textcolor{comment}{\ \ \ \ \ \ gradient,}}
\DoxyCodeLine{00858\ \textcolor{comment}{\ \ \ \ \ \ hessian,}}
\DoxyCodeLine{00859\ \textcolor{comment}{\ \ \ \ \ \ 9,}}
\DoxyCodeLine{00860\ \textcolor{comment}{\ \ \ \ \ \ 18,}}
\DoxyCodeLine{00861\ \textcolor{comment}{\ \ \ \ \ \ newton\_direction}}
\DoxyCodeLine{00862\ \textcolor{comment}{\ \ \ \ );}}
\DoxyCodeLine{00863\ \textcolor{comment}{}}
\DoxyCodeLine{00864\ \textcolor{comment}{\ \ \ \ //\ Update\ variables\ with\ Newton\ direction}}
\DoxyCodeLine{00865\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}Newton\ direction:\(\backslash\)n\{\}"{},\ newton\_direction);}}
\DoxyCodeLine{00866\ \textcolor{comment}{\ \ \ \ update\_independent\_variable\_matrix(newton\_direction,\ Gi,\ 9);}}
\DoxyCodeLine{00867\ \textcolor{comment}{\ \ \ \ update\_independent\_variable\_matrix(newton\_direction,\ Gj,\ 15);}}
\DoxyCodeLine{00868\ \textcolor{comment}{\ \ \ \ update\_independent\_variable\_matrix(newton\_direction,\ Gk,\ 21);}}
\DoxyCodeLine{00869\ \textcolor{comment}{}}
\DoxyCodeLine{00870\ \textcolor{comment}{\ \ \ \ //\ Check\ new\ gradient\ values}}
\DoxyCodeLine{00871\ \textcolor{comment}{\ \ \ \ extract\_variable\_matrix\_values(Gi,\ real\_Gi);}}
\DoxyCodeLine{00872\ \textcolor{comment}{\ \ \ \ extract\_variable\_matrix\_values(Gj,\ real\_Gj);}}
\DoxyCodeLine{00873\ \textcolor{comment}{\ \ \ \ extract\_variable\_matrix\_values(Gk,\ real\_Gk);}}
\DoxyCodeLine{00874\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}New\ gradients:\(\backslash\)n\{\}\(\backslash\)n\{\}\(\backslash\)n\{\}"{},\ real\_Gi,\ real\_Gj,\ real\_Gk);}}
\DoxyCodeLine{00875\ \textcolor{comment}{}}
\DoxyCodeLine{00876\ \textcolor{comment}{\ \ \ \ //\ Compute\ new\ energy\ with\ new\ gradients\ (should\ be\ 0)}}
\DoxyCodeLine{00877\ \textcolor{comment}{\ \ \ \ energy\ =\ triangle\_energy.triangle\_quadratic\_surface\_mapping\_energy(pi,\ pj,\ pk,\ Gi,\ Gj,\ Gk,\ Ui,\ Uj,\ Uk);}}
\DoxyCodeLine{00878\ \textcolor{comment}{\ \ \ \ energy\_value\ =\ compute\_variable\_value(energy);}}
\DoxyCodeLine{00879\ \textcolor{comment}{\ \ \ \ compute\_variable\_gradient(energy,\ gradient);}}
\DoxyCodeLine{00880\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}New\ energy:\ \{\}"{},\ energy\_value);}}
\DoxyCodeLine{00881\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}New\ gradient:\(\backslash\)n\{\}"{},\ gradient);}}
\DoxyCodeLine{00882\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(compute\_variable\_value(energy),\ 0.0)\ );}}
\DoxyCodeLine{00883\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00884\ \textcolor{comment}{}}
\DoxyCodeLine{00885\ \textcolor{comment}{}}
\DoxyCodeLine{00886\ \textcolor{comment}{\ \ SECTION\ (\ "{}Quadratic\ biharmonic"{}\ )}}
\DoxyCodeLine{00887\ \textcolor{comment}{\ \ \{}}
\DoxyCodeLine{00888\ \textcolor{comment}{\ \ \ \ //\ Get\ initial\ setup}}
\DoxyCodeLine{00889\ \textcolor{comment}{\ \ \ \ MatrixXr\ initial\_V;}}
\DoxyCodeLine{00890\ \textcolor{comment}{\ \ \ \ std::vector<MatrixXr>\ initial\_gradients;}}
\DoxyCodeLine{00891\ \textcolor{comment}{\ \ \ \ std::vector<std::vector<MatrixXr>>\ layout;}}
\DoxyCodeLine{00892\ \textcolor{comment}{\ \ \ \ //build\_quadratic\_biharmonic\_square(initial\_V,\ initial\_gradients,\ layout);}}
\DoxyCodeLine{00893\ \textcolor{comment}{\ \ \ \ build\_quadratic\_torus\_square(initial\_V,\ initial\_gradients,\ layout);}}
\DoxyCodeLine{00894\ \textcolor{comment}{\ \ \ \ }}
\DoxyCodeLine{00895\ \textcolor{comment}{\ \ \ \ //\ Build\ independent\ variables}}
\DoxyCodeLine{00896\ \textcolor{comment}{\ \ \ \ DynamicMatrixXv\ V;}}
\DoxyCodeLine{00897\ \textcolor{comment}{\ \ \ \ std::vector<DynamicVectorXv>\ positions;}}
\DoxyCodeLine{00898\ \textcolor{comment}{\ \ \ \ std::vector<DynamicMatrixXv>\ gradients;}}
\DoxyCodeLine{00899\ \textcolor{comment}{\ \ \ \ initialize\_six\_split\_variables(}}
\DoxyCodeLine{00900\ \textcolor{comment}{\ \ \ \ \ \ initial\_V,}}
\DoxyCodeLine{00901\ \textcolor{comment}{\ \ \ \ \ \ initial\_gradients,}}
\DoxyCodeLine{00902\ \textcolor{comment}{\ \ \ \ \ \ positions,}}
\DoxyCodeLine{00903\ \textcolor{comment}{\ \ \ \ \ \ gradients}}
\DoxyCodeLine{00904\ \textcolor{comment}{\ \ \ \ );}}
\DoxyCodeLine{00905\ \textcolor{comment}{}}
\DoxyCodeLine{00906\ \textcolor{comment}{\ \ \ \ //\ Perturb\ gradient\ and\ optimize}}
\DoxyCodeLine{00907\ \textcolor{comment}{\ \ \ \ gradients[4](0,\ 0)\ +=\ DynamicVar(1);}}
\DoxyCodeLine{00908\ \textcolor{comment}{\ \ \ \ gradients[4](0,\ 1)\ +=\ DynamicVar(2);}}
\DoxyCodeLine{00909\ \textcolor{comment}{\ \ \ \ gradients[4](0,\ 2)\ +=\ DynamicVar(3);}}
\DoxyCodeLine{00910\ \textcolor{comment}{\ \ \ \ gradients[4](1,\ 0)\ +=\ DynamicVar(4);}}
\DoxyCodeLine{00911\ \textcolor{comment}{\ \ \ \ gradients[4](1,\ 1)\ +=\ DynamicVar(5);}}
\DoxyCodeLine{00912\ \textcolor{comment}{\ \ \ \ gradients[4](1,\ 2)\ +=\ DynamicVar(6);}}
\DoxyCodeLine{00913\ \textcolor{comment}{}}
\DoxyCodeLine{00914\ \textcolor{comment}{\ \ \ \ //\ Sum\ quadratic\ surface\ mapping\ energies\ for\ the\ three\ triangles}}
\DoxyCodeLine{00915\ \textcolor{comment}{\ \ \ \ DynamicVar\ energy(0);}}
\DoxyCodeLine{00916\ \textcolor{comment}{\ \ \ \ TriangleEnergy\ triangle\_energy;}}
\DoxyCodeLine{00917\ \textcolor{comment}{\ \ \ \ energy\ +=\ triangle\_energy.triangle\_quadratic\_surface\_mapping\_energy(}}
\DoxyCodeLine{00918\ \textcolor{comment}{\ \ \ \ \ \ V.row(0),}}
\DoxyCodeLine{00919\ \textcolor{comment}{\ \ \ \ \ \ V.row(1),}}
\DoxyCodeLine{00920\ \textcolor{comment}{\ \ \ \ \ \ V.row(4),}}
\DoxyCodeLine{00921\ \textcolor{comment}{\ \ \ \ \ \ gradients[0],}}
\DoxyCodeLine{00922\ \textcolor{comment}{\ \ \ \ \ \ gradients[1],}}
\DoxyCodeLine{00923\ \textcolor{comment}{\ \ \ \ \ \ gradients[4],}}
\DoxyCodeLine{00924\ \textcolor{comment}{\ \ \ \ \ \ layout[0][0],}}
\DoxyCodeLine{00925\ \textcolor{comment}{\ \ \ \ \ \ layout[0][1],}}
\DoxyCodeLine{00926\ \textcolor{comment}{\ \ \ \ \ \ layout[0][2]}}
\DoxyCodeLine{00927\ \textcolor{comment}{\ \ \ \ );}}
\DoxyCodeLine{00928\ \textcolor{comment}{\ \ \ \ energy\ +=\ triangle\_energy.triangle\_quadratic\_surface\_mapping\_energy(}}
\DoxyCodeLine{00929\ \textcolor{comment}{\ \ \ \ \ \ V.row(1),}}
\DoxyCodeLine{00930\ \textcolor{comment}{\ \ \ \ \ \ V.row(2),}}
\DoxyCodeLine{00931\ \textcolor{comment}{\ \ \ \ \ \ V.row(4),}}
\DoxyCodeLine{00932\ \textcolor{comment}{\ \ \ \ \ \ gradients[1],}}
\DoxyCodeLine{00933\ \textcolor{comment}{\ \ \ \ \ \ gradients[2],}}
\DoxyCodeLine{00934\ \textcolor{comment}{\ \ \ \ \ \ gradients[4],}}
\DoxyCodeLine{00935\ \textcolor{comment}{\ \ \ \ \ \ layout[1][0],}}
\DoxyCodeLine{00936\ \textcolor{comment}{\ \ \ \ \ \ layout[1][1],}}
\DoxyCodeLine{00937\ \textcolor{comment}{\ \ \ \ \ \ layout[1][2]}}
\DoxyCodeLine{00938\ \textcolor{comment}{\ \ \ \ );}}
\DoxyCodeLine{00939\ \textcolor{comment}{\ \ \ \ energy\ +=\ triangle\_energy.triangle\_quadratic\_surface\_mapping\_energy(}}
\DoxyCodeLine{00940\ \textcolor{comment}{\ \ \ \ \ \ V.row(2),}}
\DoxyCodeLine{00941\ \textcolor{comment}{\ \ \ \ \ \ V.row(3),}}
\DoxyCodeLine{00942\ \textcolor{comment}{\ \ \ \ \ \ V.row(4),}}
\DoxyCodeLine{00943\ \textcolor{comment}{\ \ \ \ \ \ gradients[2],}}
\DoxyCodeLine{00944\ \textcolor{comment}{\ \ \ \ \ \ gradients[3],}}
\DoxyCodeLine{00945\ \textcolor{comment}{\ \ \ \ \ \ gradients[4],}}
\DoxyCodeLine{00946\ \textcolor{comment}{\ \ \ \ \ \ layout[2][0],}}
\DoxyCodeLine{00947\ \textcolor{comment}{\ \ \ \ \ \ layout[2][1],}}
\DoxyCodeLine{00948\ \textcolor{comment}{\ \ \ \ \ \ layout[2][2]}}
\DoxyCodeLine{00949\ \textcolor{comment}{\ \ \ \ );}}
\DoxyCodeLine{00950\ \textcolor{comment}{\ \ \ \ energy\ +=\ triangle\_energy.triangle\_quadratic\_surface\_mapping\_energy(}}
\DoxyCodeLine{00951\ \textcolor{comment}{\ \ \ \ \ \ V.row(3),}}
\DoxyCodeLine{00952\ \textcolor{comment}{\ \ \ \ \ \ V.row(0),}}
\DoxyCodeLine{00953\ \textcolor{comment}{\ \ \ \ \ \ V.row(4),}}
\DoxyCodeLine{00954\ \textcolor{comment}{\ \ \ \ \ \ gradients[3],}}
\DoxyCodeLine{00955\ \textcolor{comment}{\ \ \ \ \ \ gradients[0],}}
\DoxyCodeLine{00956\ \textcolor{comment}{\ \ \ \ \ \ gradients[4],}}
\DoxyCodeLine{00957\ \textcolor{comment}{\ \ \ \ \ \ layout[3][0],}}
\DoxyCodeLine{00958\ \textcolor{comment}{\ \ \ \ \ \ layout[3][1],}}
\DoxyCodeLine{00959\ \textcolor{comment}{\ \ \ \ \ \ layout[3][2]}}
\DoxyCodeLine{00960\ \textcolor{comment}{\ \ \ \ );}}
\DoxyCodeLine{00961\ \textcolor{comment}{}}
\DoxyCodeLine{00962\ \textcolor{comment}{\ \ \ \ //\ Compute\ energy\ with\ gradient\ and\ hessian}}
\DoxyCodeLine{00963\ \textcolor{comment}{\ \ \ \ double\ energy\_value\ =\ compute\_variable\_value(energy);}}
\DoxyCodeLine{00964\ \textcolor{comment}{\ \ \ \ compute\_variable\_gradient(energy,\ gradient);}}
\DoxyCodeLine{00965\ \textcolor{comment}{\ \ \ \ compute\_variable\_hessian(energy,\ hessian);}}
\DoxyCodeLine{00966\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}Energy:\ \{\}"{},\ energy\_value);}}
\DoxyCodeLine{00967\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}Gradient:\(\backslash\)n\{\}"{},\ gradient);}}
\DoxyCodeLine{00968\ \textcolor{comment}{}}
\DoxyCodeLine{00969\ \textcolor{comment}{\ \ \ \ //\ Compute\ newton\ direction\ for\ the\ center\ gradient}}
\DoxyCodeLine{00970\ \textcolor{comment}{\ \ \ \ VectorXr\ center\_gradient\ =\ gradient.segment(39,\ 6);}}
\DoxyCodeLine{00971\ \textcolor{comment}{\ \ \ \ MatrixXr\ center\_hessian\ =\ hessian.block(39,\ 39,\ 6,\ 6);}}
\DoxyCodeLine{00972\ \textcolor{comment}{\ \ \ \ VectorXr\ center\_newton\_direction\ =\ center\_hessian.ldlt().solve(center\_gradient);}}
\DoxyCodeLine{00973\ \textcolor{comment}{\ \ \ \ spdlog::trace("{}Newton\ direction:\(\backslash\)n\{\}"{},\ center\_newton\_direction);}}
\DoxyCodeLine{00974\ \textcolor{comment}{}}
\DoxyCodeLine{00975\ \textcolor{comment}{\ \ \ \ //\ Newton\ direction\ is\ the\ perturbation}}
\DoxyCodeLine{00976\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(center\_newton\_direction[0],\ 1.0)\ );}}
\DoxyCodeLine{00977\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(center\_newton\_direction[1],\ 2.0)\ );}}
\DoxyCodeLine{00978\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(center\_newton\_direction[2],\ 3.0)\ );}}
\DoxyCodeLine{00979\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(center\_newton\_direction[3],\ 4.0)\ );}}
\DoxyCodeLine{00980\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(center\_newton\_direction[4],\ 5.0)\ );}}
\DoxyCodeLine{00981\ \textcolor{comment}{\ \ \ \ REQUIRE\ (\ float\_equal(center\_newton\_direction[5],\ 6.0)\ );}}
\DoxyCodeLine{00982\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00983\ \textcolor{comment}{\}}}
\DoxyCodeLine{00984\ \textcolor{comment}{*/}}
\DoxyCodeLine{00985\ }
\DoxyCodeLine{00986\ \textcolor{comment}{//\ FIXME\ Redundant\ triangle\ energy\ test}}
\DoxyCodeLine{00987\ \textcolor{comment}{//TEST\_CASE\ (\ "{}Corner\ least\ squares\ energy\ can\ be\ computed"{},\ "{}[optimize\_spline\_surface]"{})}}
\DoxyCodeLine{00988\ \textcolor{comment}{//\{}}
\DoxyCodeLine{00989\ \textcolor{comment}{//\ \ MatrixXr\ P(3,\ 3);}}
\DoxyCodeLine{00990\ \textcolor{comment}{//\ \ MatrixXr\ G(2,\ 3);}}
\DoxyCodeLine{00991\ \textcolor{comment}{//\ \ DynamicVectorXv\ pi,\ pj,\ pk;}}
\DoxyCodeLine{00992\ \textcolor{comment}{//\ \ VectorXr\ uj(2);}}
\DoxyCodeLine{00993\ \textcolor{comment}{//\ \ VectorXr\ uk(2);}}
\DoxyCodeLine{00994\ \textcolor{comment}{//\ \ DynamicMatrixXv\ Gi;}}
\DoxyCodeLine{00995\ \textcolor{comment}{//}}
\DoxyCodeLine{00996\ \textcolor{comment}{//\ \ SECTION\ (\ "{}Zero"{}\ )}}
\DoxyCodeLine{00997\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{00998\ \textcolor{comment}{//\ \ \ \ P\ <<\ }}
\DoxyCodeLine{00999\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{01000\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{01001\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{01002\ \textcolor{comment}{//\ \ \ \ G\ <<}}
\DoxyCodeLine{01003\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{01004\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0;}}
\DoxyCodeLine{01005\ \textcolor{comment}{//\ \ \ \ uj\ <<\ 1,\ 0;}}
\DoxyCodeLine{01006\ \textcolor{comment}{//}}
\DoxyCodeLine{01007\ \textcolor{comment}{//\ \ \ \ build\_corner\_variables(P,\ G,\ pi,\ pj,\ pk,\ Gi);}}
\DoxyCodeLine{01008\ \textcolor{comment}{//\ \ \ \ TriangleEnergy\ triangle\_energy;}}
\DoxyCodeLine{01009\ \textcolor{comment}{//\ \ \ \ DynamicVar\ energy\ =\ triangle\_energy.triangle\_corner\_to\_corner\_least\_squares\_energy(pi,\ pj,\ Gi,\ uj);}}
\DoxyCodeLine{01010\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Zero\ edge\ energy:\ \{\}"{},\ compute\_variable\_value(energy));}}
\DoxyCodeLine{01011\ \textcolor{comment}{//\ \ \ \ //spdlog::trace("{}Zero\ edge\ gradient:\ \{\}"{},\ energy.derivatives());}}
\DoxyCodeLine{01012\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ float\_equal(compute\_variable\_value(energy),\ 0.0)\ );}}
\DoxyCodeLine{01013\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{01014\ \textcolor{comment}{//}}
\DoxyCodeLine{01015\ \textcolor{comment}{//\ \ SECTION\ (\ "{}Constant"{}\ )}}
\DoxyCodeLine{01016\ \textcolor{comment}{//\ \ \{}}
\DoxyCodeLine{01017\ \textcolor{comment}{//\ \ \ \ P\ <<\ }}
\DoxyCodeLine{01018\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 0,\ 0,}}
\DoxyCodeLine{01019\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 0,\ 0,}}
\DoxyCodeLine{01020\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 1,\ 0;}}
\DoxyCodeLine{01021\ \textcolor{comment}{//\ \ \ \ G\ <<}}
\DoxyCodeLine{01022\ \textcolor{comment}{//\ \ \ \ \ \ 1,\ 0,\ 0,}}
\DoxyCodeLine{01023\ \textcolor{comment}{//\ \ \ \ \ \ 0,\ 1,\ 0;}}
\DoxyCodeLine{01024\ \textcolor{comment}{//\ \ \ \ uj\ <<\ 1,\ 0;}}
\DoxyCodeLine{01025\ \textcolor{comment}{//\ \ \ \ uk\ <<\ 0,\ 1;\ }}
\DoxyCodeLine{01026\ \textcolor{comment}{//}}
\DoxyCodeLine{01027\ \textcolor{comment}{//\ \ \ \ build\_corner\_variables(P,\ G,\ pi,\ pj,\ pk,\ Gi);}}
\DoxyCodeLine{01028\ \textcolor{comment}{//\ \ \ \ TriangleEnergy\ triangle\_energy;}}
\DoxyCodeLine{01029\ \textcolor{comment}{//\ \ \ \ DynamicVar\ energy\ =\ triangle\_energy.triangle\_corner\_to\_corner\_least\_squares\_energy(pi,\ pj,\ Gi,\ uj);}}
\DoxyCodeLine{01030\ \textcolor{comment}{//\ \ \ \ spdlog::trace("{}Constant\ edge\ energy:\ \{\}"{},\ compute\_variable\_value(energy));}}
\DoxyCodeLine{01031\ \textcolor{comment}{//\ \ \ \ //spdlog::trace("{}Constant\ edge\ gradient:\ \{\}"{},\ energy.derivatives());}}
\DoxyCodeLine{01032\ \textcolor{comment}{//\ \ \ \ REQUIRE\ (\ float\_equal(compute\_variable\_value(energy),\ 0.0)\ );}}
\DoxyCodeLine{01033\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{01034\ \textcolor{comment}{//\}}}

\end{DoxyCode}
